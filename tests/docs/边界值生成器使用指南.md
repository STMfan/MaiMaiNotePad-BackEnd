# 边界值生成器使用指南

## 概述

`BoundaryValueGenerator` 是一个用于自动生成边界值和极端情况测试用例的工具类。它可以帮助开发者系统化地测试函数在各种边界条件下的行为。

## 快速开始

### 使用 Pytest Fixtures（推荐）

边界值生成器已集成到 pytest 框架中，可以直接使用 fixtures：

```python
def test_username_validation(string_boundaries):
    """使用 string_boundaries fixture 测试用户名验证"""
    def validate_username(username: str) -> bool:
        return 3 <= len(username) <= 20
    
    for boundary in string_boundaries:
        result = validate_username(boundary.value)
        # 验证逻辑
```

### 可用的 Fixtures

- `boundary_generator` - BoundaryValueGenerator 实例（session scope）
- `null_boundaries` - 空值边界值列表
- `string_boundaries` - 字符串边界值列表
- `integer_boundaries` - 整数边界值列表
- `float_boundaries` - 浮点数边界值列表
- `list_boundaries` - 列表边界值列表
- `dict_boundaries` - 字典边界值列表

## 核心概念

### BoundaryValue 数据类

每个边界值都是一个 `BoundaryValue` 实例，包含：

- `value`: 边界值本身
- `description`: 边界值的描述
- `expected_behavior`: 预期行为
  - `"handle_gracefully"`: 应该正常处理
  - `"raise_exception"`: 应该抛出异常
  - `"return_none"`: 应该返回 None
- `category`: 边界值类别
  - `"boundary"`: 一般边界值
  - `"null"`: 空值
  - `"empty"`: 空容器
  - `"max"`: 最大值
  - `"min"`: 最小值
  - `"extreme"`: 极端值

## 支持的边界值类型

### 1. 空值 (Null Values)
None, 空字符串, 空列表, 空字典, 空元组, 空集合

### 2. 字符串边界值
空字符串, 单字符, 最大长度, 超长, 特殊字符, XSS/SQL注入, Unicode字符

### 3. 数值边界值
零, 正负数, 最小/最大值, 无穷大, NaN

### 4. 容器边界值
空容器, 单元素, 最大长度, 超长, 包含None的容器

## 常用示例

### 示例 1：测试字符串处理

```python
def test_process_username_boundaries(string_boundaries):
    """测试用户名处理的边界情况"""
    def process_username(username: str) -> str:
        if not username:
            raise ValueError("Username cannot be empty")
        if len(username) > 50:
            raise ValueError("Username too long")
        return username.strip().lower()
    
    for boundary in string_boundaries:
        if boundary.expected_behavior == "raise_exception":
            with pytest.raises(ValueError):
                process_username(boundary.value)
        else:
            result = process_username(boundary.value)
            assert isinstance(result, str)
```

### 示例 2：测试整数验证

```python
def test_validate_age_boundaries(integer_boundaries):
    """测试年龄验证的边界情况"""
    def validate_age(age: int) -> bool:
        return 0 <= age <= 150
    
    for boundary in integer_boundaries:
        result = validate_age(boundary.value)
        
        if boundary.category == "extreme":
            assert result is False
        elif boundary.value in [0, 150]:
            assert result is True
```

### 示例 3：测试空值处理

```python
def test_null_value_handling(null_boundaries):
    """测试函数对空值的处理"""
    def process_data(data):
        if data is None:
            return {"error": "No data"}
        if not data:
            return {"error": "Empty data"}
        return {"status": "success", "data": data}
    
    for boundary in null_boundaries:
        result = process_data(boundary.value)
        assert isinstance(result, dict)
```

### 示例 4：自定义边界值

```python
def test_custom_boundaries(boundary_generator):
    """使用自定义参数生成边界值"""
    # 生成最大长度为 20 的字符串边界值
    boundaries = boundary_generator.generate_string_boundaries(max_length=20)
    
    # 生成 0-100 范围的整数边界值
    int_boundaries = boundary_generator.generate_integer_boundaries(
        min_value=0, 
        max_value=100
    )
    
    for boundary in boundaries:
        # 测试逻辑
        pass
```

## 辅助函数

### assert_boundary_behavior()

根据边界值的预期行为自动执行测试：

```python
from tests.conftest import assert_boundary_behavior

def test_process_data(boundary_generator):
    boundaries = boundary_generator.generate_string_boundaries()
    for boundary in boundaries:
        result = assert_boundary_behavior(
            boundary,
            process_data,
            boundary.value
        )
        if result is not None:
            assert isinstance(result, dict)
```

### generate_null_test_cases()

生成空值测试用例：

```python
from tests.conftest import generate_null_test_cases

def test_user_creation():
    def create_user(username, email):
        return {"username": username, "email": email}
    
    test_cases = generate_null_test_cases(create_user, "username")
    for test_case in test_cases:
        result = create_user(test_case["param_value"], "test@example.com")
        # 验证逻辑
```

## API 参考

### 主要方法

- `generate_null_values()` - 生成基本空值
- `generate_string_boundaries(max_length=10000)` - 生成字符串边界值
- `generate_integer_boundaries(min_value=None, max_value=None)` - 生成整数边界值
- `generate_float_boundaries(min_value=None, max_value=None)` - 生成浮点数边界值
- `generate_list_boundaries(max_length=1000, element_type=None)` - 生成列表边界值
- `generate_dict_boundaries(max_keys=100)` - 生成字典边界值
- `generate_all_boundaries(value_type=None)` - 生成所有类型的边界值

### 测试用例生成

- `generate_null_test_cases(function, param_name, include_nested=True)` - 生成空值测试用例
- `generate_null_combinations(function, param_names)` - 生成多参数空值组合
- `generate_max_value_test_cases(function, param_name, param_type, max_value, **kwargs)` - 生成最大值测试用例
- `generate_concurrent_test_cases(function, num_threads, num_operations, operation_type)` - 生成并发测试用例

## 最佳实践

### 1. 选择合适的边界值类型

根据被测试函数的参数类型选择合适的边界值生成方法。

### 2. 使用预期行为进行断言

根据 `expected_behavior` 字段编写相应的断言：

```python
for boundary in boundaries:
    if boundary.expected_behavior == "raise_exception":
        with pytest.raises(Exception):
            function_under_test(boundary.value)
    elif boundary.expected_behavior == "handle_gracefully":
        result = function_under_test(boundary.value)
        assert result is not None
```

### 3. 关注边界值类别

使用 `category` 字段来组织测试：

```python
# 只测试极端值
extreme_values = [bv for bv in boundaries if bv.category == "extreme"]

# 只测试空值
null_values = [bv for bv in boundaries if bv.category == "null"]
```

### 4. 自定义边界值范围

根据实际业务需求自定义边界值范围：

```python
# 用户名长度限制为 3-20 个字符
username_boundaries = generator.generate_string_boundaries(max_length=20)

# 年龄范围 0-150
age_boundaries = generator.generate_integer_boundaries(min_value=0, max_value=150)
```

### 5. 结合参数化测试

使用 pytest 的参数化测试功能：

```python
@pytest.mark.parametrize("boundary", generator.generate_string_boundaries())
def test_function_with_boundaries(boundary):
    """参数化测试"""
    if boundary.expected_behavior == "raise_exception":
        with pytest.raises(Exception):
            function_under_test(boundary.value)
    else:
        result = function_under_test(boundary.value)
        assert result is not None
```

## 相关文档

- [测试说明](./测试说明.md) - 测试目录结构和使用指南
- [异常注入器使用指南](./异常注入器使用指南.md) - 异常注入测试
- [属性测试说明](./属性测试说明.md) - 属性测试方法

---

**最后更新**: 2026-02-22
**维护者**: 开发团队
