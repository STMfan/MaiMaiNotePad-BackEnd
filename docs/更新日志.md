# ä¿®æ”¹æ—¥å¿— (CHANGELOG)

## ç‰ˆæœ¬å†å²æ€»è§ˆ

| ç‰ˆæœ¬ | æ—¥æœŸ | ç±»å‹ | ä¸»è¦å˜æ›´ |
|------|------|------|---------|
| 2.2.0 | 2026-02-24 | åŠŸèƒ½ | AI å†…å®¹å®¡æ ¸åŠŸèƒ½é›†æˆ |
| 2.1.0 | 2026-02-24 | åŠŸèƒ½ | Redis ç¼“å­˜æœºåˆ¶é›†æˆä¸æµ‹è¯•ä¼˜åŒ– |
| 2.0.1 | 2026-02-22 | ä¼˜åŒ– | æ–‡ä»¶ç»“æ„ä¼˜åŒ–ä¸ç‰ˆæœ¬ç®¡ç†å®Œå–„ |
| 2.0.0 | 2026-02-22 | é‡æ„ | é¡¹ç›®é‡æ„å®Œæˆ |
| 1.0.0 | 2026-02-20 | å‘å¸ƒ | åˆå§‹ç‰ˆæœ¬å‘å¸ƒ |

---

## v2.2.0 (2026-02-24) - AI å†…å®¹å®¡æ ¸åŠŸèƒ½é›†æˆ

### ğŸ¯ æœ¬ç‰ˆæœ¬é‡ç‚¹
- é›†æˆåŸºäºç¡…åŸºæµåŠ¨ Qwen æ¨¡å‹çš„ AI å†…å®¹å®¡æ ¸åŠŸèƒ½
- æ”¯æŒè‰²æƒ…ã€æ¶‰æ”¿ã€è¾±éª‚ä¸‰ç±»è¿è§„å†…å®¹è‡ªåŠ¨æ£€æµ‹
- æä¾›å®Œæ•´çš„ API æ¥å£å’Œä½¿ç”¨æ–‡æ¡£
- 5 åˆ†é’Ÿå¿«é€Ÿé›†æˆï¼Œå¼€ç®±å³ç”¨

---

## 2026-02-24 - AI å†…å®¹å®¡æ ¸åŠŸèƒ½

### æ–°å¢ AI å†…å®¹å®¡æ ¸ç³»ç»Ÿ ğŸ¤–

#### åŠŸèƒ½ç‰¹æ€§
- **æ™ºèƒ½å®¡æ ¸**: åŸºäºç¡…åŸºæµåŠ¨ Qwen/Qwen2.5-7B-Instruct æ¨¡å‹
- **å¤šç±»å‹æ£€æµ‹**: æ”¯æŒè‰²æƒ…ã€æ¶‰æ”¿ã€è¾±éª‚ä¸‰ç±»è¿è§„å†…å®¹æ£€æµ‹
- **ç½®ä¿¡åº¦è¯„åˆ†**: æä¾› 0-1 çš„è¿è§„ç½®ä¿¡åº¦è¯„åˆ†
- **ä¸‰çº§åˆ¤æ–­**: é€šè¿‡/æ‹’ç»/ä¸ç¡®å®šä¸‰ç§å®¡æ ¸ç»“æœ
- **çµæ´»é…ç½®**: æ”¯æŒè‡ªå®šä¹‰æ¨¡å‹å‚æ•°å’Œå®¡æ ¸é˜ˆå€¼

#### å®ç°ä½ç½®
- `app/services/moderation_service.py` - å®¡æ ¸æœåŠ¡æ¨¡å—
  - `ModerationService` ç±»ï¼šæ ¸å¿ƒå®¡æ ¸é€»è¾‘
  - `get_moderation_service()` å‡½æ•°ï¼šå•ä¾‹æ¨¡å¼è·å–æœåŠ¡å®ä¾‹
- `app/api/routes/moderation.py` - å®¡æ ¸ API è·¯ç”±
  - `POST /api/moderation/check` - å†…å®¹å®¡æ ¸æ¥å£
  - `GET /api/moderation/health` - å¥åº·æ£€æŸ¥æ¥å£
- `app/models/schemas.py` - æ•°æ®æ¨¡å‹
  - `ModerationRequest` - å®¡æ ¸è¯·æ±‚æ¨¡å‹
  - `ModerationResult` - å®¡æ ¸ç»“æœæ¨¡å‹
  - `ModerationResponse` - å®¡æ ¸å“åº”æ¨¡å‹

#### å®¡æ ¸èŒƒå›´
1. **è‰²æƒ…ï¼ˆpornï¼‰**: éœ²éª¨çš„æ€§è¡Œä¸ºæå†™ã€è‰²æƒ…è¯æ±‡
2. **æ¶‰æ”¿ï¼ˆpoliticsï¼‰**: ä¸­å›½å›½å†…æ”¿æ²»æ•æ„Ÿå†…å®¹ã€é¢†å¯¼äººè´Ÿé¢è¯„ä»·ã€æ•æ„Ÿå†å²äº‹ä»¶
3. **è¾±éª‚ï¼ˆabuseï¼‰**: ç²—å£è„è¯

#### åˆ¤æ–­é€»è¾‘
- **æ˜ç¡®è¿è§„**ï¼ˆç½®ä¿¡åº¦ > 0.8ï¼‰: è¿”å› `decision: "false"`
- **æ˜ç¡®æ­£å¸¸**ï¼ˆç½®ä¿¡åº¦ < 0.4ï¼‰: è¿”å› `decision: "true"`
- **ä¸ç¡®å®š**ï¼ˆç½®ä¿¡åº¦ 0.4-0.8ï¼‰: è¿”å› `decision: "unknown"`ï¼Œå»ºè®®äººå·¥å¤å®¡

#### é…ç½®è¯´æ˜
- ç¯å¢ƒå˜é‡ï¼š`SILICONFLOW_API_KEY`ï¼ˆå¿…éœ€ï¼‰
- API åœ°å€ï¼š`https://api.siliconflow.cn/v1`
- æ¨¡å‹ï¼š`Qwen/Qwen2.5-7B-Instruct`
- é»˜è®¤å‚æ•°ï¼š`temperature=0.1`, `max_tokens=100`

#### ä½¿ç”¨ç¤ºä¾‹

**Python é›†æˆ**:
```python
from app.services.moderation_service import get_moderation_service

service = get_moderation_service()
result = service.moderate(text="ç”¨æˆ·è¯„è®ºå†…å®¹", text_type="comment")

if result["decision"] == "false":
    print(f"å†…å®¹è¿è§„ï¼š{result['violation_types']}")
```

**API è°ƒç”¨**:
```bash
curl -X POST "http://localhost:8000/api/moderation/check" \
  -H "Content-Type: application/json" \
  -d '{"text": "å¾…å®¡æ ¸å†…å®¹", "text_type": "comment"}'
```

#### æ–‡æ¡£èµ„æº
- **å®Œæ•´æŒ‡å—**: `docs/guides/AIå†…å®¹å®¡æ ¸ä½¿ç”¨æŒ‡å—.md`
  - è¯¦ç»†çš„åŠŸèƒ½è¯´æ˜å’Œé…ç½®æ­¥éª¤
  - Python å’Œ JavaScript é›†æˆç¤ºä¾‹
  - æœ€ä½³å®è·µå’Œæ€§èƒ½ä¼˜åŒ–å»ºè®®
  - æ•…éšœæ’æŸ¥æŒ‡å—
- **å¿«é€Ÿå¼€å§‹**: `docs/guides/AIå†…å®¹å®¡æ ¸å¿«é€Ÿå¼€å§‹.md`
  - 5 åˆ†é’Ÿå¿«é€Ÿé›†æˆæŒ‡å—
  - å¸¸è§é—®é¢˜è§£ç­”
- **å®æ–½æ€»ç»“**: `docs/archive/AIå†…å®¹å®¡æ ¸æ¨¡å—å®æ–½æ€»ç»“_2026-02-24.md`
  - å®Œæ•´çš„å®æ–½è®°å½•å’ŒæŠ€æœ¯ç»†èŠ‚

#### æ¼”ç¤ºä»£ç 
- `examples/moderation_demo.py` - å¯æ‰§è¡Œçš„æ¼”ç¤ºè„šæœ¬

#### ä¾èµ–æ›´æ–°
- æ–°å¢ä¾èµ–ï¼š`openai==1.59.5`

---

## v2.1.0 (2026-02-24) - Redis ç¼“å­˜æœºåˆ¶é›†æˆä¸æµ‹è¯•ä¼˜åŒ–

### ğŸ¯ æœ¬ç‰ˆæœ¬é‡ç‚¹
- é›†æˆ Redis ç¼“å­˜æœºåˆ¶ï¼Œæå‡ API å“åº”æ€§èƒ½
- ä¼˜åŒ–æµ‹è¯•æ¡†æ¶ï¼Œç¡®ä¿å¹¶è¡Œæµ‹è¯•ç¨³å®šæ€§
- ä¿®å¤å­—å…¸è·¯ç”±æµ‹è¯•åœ¨å¹¶è¡Œæ¨¡å¼ä¸‹çš„å¶å‘å¤±è´¥é—®é¢˜

---

## 2026-02-24 - Redis ç¼“å­˜æœºåˆ¶é›†æˆ

### æ–°å¢ Redis ç¼“å­˜ç³»ç»Ÿ ğŸš€

#### åŠŸèƒ½ç‰¹æ€§
- **ç¼“å­˜ä¸­é—´ä»¶**: è‡ªåŠ¨ç¼“å­˜æ‰€æœ‰ GET è¯·æ±‚å“åº”
- **ç¼“å­˜ç®¡ç†å™¨**: æä¾›ç»Ÿä¸€çš„ç¼“å­˜æ“ä½œæ¥å£
- **ç¼“å­˜è£…é¥°å™¨**: æ”¯æŒå‡½æ•°çº§åˆ«çš„ç¼“å­˜æ§åˆ¶
- **ç¼“å­˜æŒ‡æ ‡**: å®æ—¶ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡å’Œæ€§èƒ½
- **é™çº§æ¨¡å¼**: Redis ä¸å¯ç”¨æ—¶è‡ªåŠ¨é™çº§åˆ°æ— ç¼“å­˜æ¨¡å¼

#### å®ç°ä½ç½®
- `app/core/cache/` - ç¼“å­˜æ¨¡å—
  - `redis_client.py` - Redis å®¢æˆ·ç«¯å°è£…
  - `manager.py` - ç¼“å­˜ç®¡ç†å™¨
  - `middleware.py` - ç¼“å­˜ä¸­é—´ä»¶
  - `decorators.py` - ç¼“å­˜è£…é¥°å™¨
  - `metrics.py` - ç¼“å­˜æŒ‡æ ‡ç›‘æ§
  - `config.py` - ç¼“å­˜é…ç½®
  - `factory.py` - ç¼“å­˜å·¥å‚
  - `logger.py` - ç¼“å­˜æ—¥å¿—

#### é…ç½®è¯´æ˜
- æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡é…ç½® Redis è¿æ¥
- æ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶è‡ªå®šä¹‰ç¼“å­˜ç­–ç•¥
- é»˜è®¤ TTL: 300 ç§’ï¼ˆ5 åˆ†é’Ÿï¼‰
- æ”¯æŒ `Cache-Control: no-cache` è¯·æ±‚å¤´ç¦ç”¨ç¼“å­˜

#### æ€§èƒ½æå‡
- GET è¯·æ±‚å“åº”æ—¶é—´æ˜¾è‘—é™ä½
- å‡å°‘æ•°æ®åº“æŸ¥è¯¢å‹åŠ›
- æå‡ç³»ç»Ÿæ•´ä½“ååé‡

---

## 2026-02-24 - å­—å…¸è·¯ç”±æµ‹è¯•å¹¶è¡Œæ¨¡å¼ä¿®å¤

### ä¿®å¤æµ‹è¯•åœ¨å¹¶è¡Œæ¨¡å¼ä¸‹çš„å¶å‘å¤±è´¥ âœ…

#### é—®é¢˜æè¿°
- `test_dictionary_routes.py` ä¸­çš„æµ‹è¯•åœ¨å¹¶è¡Œè¿è¡Œæ—¶å¶å‘å¤±è´¥
- æ ¹æœ¬åŸå› ï¼šç¼“å­˜ä¸­é—´ä»¶ä¼šç¼“å­˜æ‰€æœ‰ GET è¯·æ±‚çš„å“åº”
- è™½ç„¶é€šè¿‡ `monkeypatch` è®¾ç½®äº†ç¯å¢ƒå˜é‡ï¼Œä½†ç”±äºç¼“å­˜ï¼Œè·¯ç”±å¤„ç†å™¨æ²¡æœ‰è¢«è°ƒç”¨

#### è§£å†³æ–¹æ¡ˆ

**1. è·¯ç”±å±‚é¢ä¼˜åŒ–**
- ä¿®æ”¹ `app/api/routes/dictionary.py`
- æ·»åŠ  `_get_dict_file_path()` å‡½æ•°
- æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡ `TRANSLATION_DICT_PATH` è¦†ç›–å­—å…¸æ–‡ä»¶è·¯å¾„

**2. æµ‹è¯•å±‚é¢ä¼˜åŒ–**
- ä¿®æ”¹ `tests/integration/routes/test_dictionary_routes.py`
- ç§»é™¤æ‰€æœ‰ `@patch` è£…é¥°å™¨å’Œå¯¹å‡½æ•°çš„ mock
- æ”¹ç”¨ç¯å¢ƒå˜é‡ + çœŸå®ä¸´æ—¶æ–‡ä»¶çš„æ–¹å¼ï¼ˆé€šè¿‡ `tmp_path` fixtureï¼‰
- åœ¨æ‰€æœ‰ä½¿ç”¨ mock çš„æµ‹è¯•ä¸­æ·»åŠ  `Cache-Control: no-cache` è¯·æ±‚å¤´
- ç§»é™¤ `autouse` fixtureï¼Œé¿å…å½±å“ä¸éœ€è¦ mock çš„æµ‹è¯•

#### æµ‹è¯•ç»“æœ
- âœ… å¹¶è¡Œæ¨¡å¼ï¼ˆ`pytest -n auto`ï¼‰ï¼š10/10 é€šè¿‡
- âœ… éå¹¶è¡Œæ¨¡å¼ï¼š10/10 é€šè¿‡
- âœ… ä»£ç è¦†ç›–ç‡ï¼š`app/api/routes/dictionary.py` è¾¾åˆ° 100%

#### ç›¸å…³æ–‡ä»¶
- `app/api/routes/dictionary.py` - å­—å…¸è·¯ç”±å®ç°
- `tests/integration/routes/test_dictionary_routes.py` - å­—å…¸è·¯ç”±æµ‹è¯•

---

## 2026-02-24 - æµ‹è¯•æ¡†æ¶ä¼˜åŒ–

### å¹¶è¡Œæµ‹è¯•ç¨³å®šæ€§æå‡ âš¡

#### ä¼˜åŒ–å†…å®¹
- ç¡®ä¿æ‰€æœ‰æµ‹è¯•åœ¨å¹¶è¡Œæ¨¡å¼ä¸‹ç¨³å®šé€šè¿‡
- ä¼˜åŒ–æµ‹è¯•éš”ç¦»æœºåˆ¶
- æ”¹è¿›æµ‹è¯•æ•°æ®ç®¡ç†ç­–ç•¥

#### æµ‹è¯•æ‰§è¡Œ
- æ”¯æŒ `pytest -n auto` å¹¶è¡Œæ‰§è¡Œ
- æ¯ä¸ª worker ç‹¬ç«‹çš„ Python è¿›ç¨‹å’Œæ•°æ®åº“
- æµ‹è¯•ä¹‹é—´å®Œå…¨éš”ç¦»ï¼Œæ— çŠ¶æ€å…±äº«

#### æµ‹è¯•è¦†ç›–
- å•å…ƒæµ‹è¯•ï¼š963 ä¸ª
- é›†æˆæµ‹è¯•ï¼šåŒ…å«è·¯ç”±æµ‹è¯•
- å±æ€§æµ‹è¯•ï¼šä½¿ç”¨ Hypothesis æ¡†æ¶

---

### å½±å“èŒƒå›´

**æ–°å¢åŠŸèƒ½**ï¼š
- Redis ç¼“å­˜ç³»ç»Ÿå®Œæ•´å®ç°
- ç¼“å­˜ä¸­é—´ä»¶è‡ªåŠ¨ç¼“å­˜ GET è¯·æ±‚
- ç¼“å­˜ç®¡ç†å’Œç›‘æ§åŠŸèƒ½

**æµ‹è¯•ä¼˜åŒ–**ï¼š
- å­—å…¸è·¯ç”±æµ‹è¯•å¹¶è¡Œæ¨¡å¼ä¿®å¤
- æµ‹è¯•æ¡†æ¶ç¨³å®šæ€§æå‡
- æµ‹è¯•è¦†ç›–ç‡ä¿æŒé«˜æ°´å¹³

**é…ç½®å˜æ›´**ï¼š
- æ–°å¢ Redis ç›¸å…³é…ç½®é¡¹
- æ”¯æŒç¯å¢ƒå˜é‡é…ç½®ç¼“å­˜ç­–ç•¥

**å‡çº§è¯´æ˜**ï¼š
- éœ€è¦é…ç½® Redis æœåŠ¡å™¨ï¼ˆå¯é€‰ï¼Œä¸é…ç½®æ—¶è‡ªåŠ¨é™çº§ï¼‰
- å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒå¯ç”¨ Redis ç¼“å­˜ä»¥è·å¾—æœ€ä½³æ€§èƒ½
- æ‰€æœ‰ç°æœ‰ API æ¥å£ä¿æŒå‘ä¸‹å…¼å®¹

---

## v2.0.1 (2026-02-22) - æ–‡ä»¶ç»“æ„ä¼˜åŒ–ä¸ç‰ˆæœ¬ç®¡ç†å®Œå–„

### ğŸ¯ æœ¬ç‰ˆæœ¬é‡ç‚¹
- ä¼˜åŒ–é¡¹ç›®æ–‡ä»¶ç»“æ„ï¼Œæå‡ä»£ç ç»„ç»‡æ¸…æ™°åº¦
- å®Œå–„ç‰ˆæœ¬å·ç®¡ç†ç³»ç»Ÿï¼Œå®ç°å•ä¸€æ¥æºåŸåˆ™
- æ¸…ç†é…ç½®æ–‡ä»¶å†—ä½™ï¼Œç®€åŒ–ç‰ˆæœ¬æ›´æ–°æµç¨‹

---

## 2026-02-22 - App æ ¹ç›®å½•æ–‡ä»¶ç»“æ„ä¼˜åŒ–

### ç§»åŠ¨ä¸šåŠ¡ä»£ç åˆ°åˆé€‚çš„å­ç›®å½• ğŸ“

#### é—®é¢˜
- `app/error_handlers.py` å’Œ `app/file_upload.py` æ”¾åœ¨æ ¹ç›®å½•ä¸‹
- è¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸šåŠ¡ä»£ç ï¼Œä¸åº”è¯¥åœ¨æ ¹ç›®å½•
- ç›®å½•ç»“æ„ä¸å¤Ÿæ¸…æ™°ï¼Œä¸ç¬¦åˆåˆ†å±‚æ¶æ„åŸåˆ™

#### è§£å†³æ–¹æ¡ˆ

**1. æºä»£ç æ–‡ä»¶ç§»åŠ¨**
- `app/error_handlers.py` â†’ `app/core/error_handlers.py`
  - æ ¸å¿ƒåŸºç¡€è®¾æ–½ä»£ç 
  - åŒ…å«é”™è¯¯å¤„ç†ä¸­é—´ä»¶ã€è‡ªå®šä¹‰å¼‚å¸¸ç±»
  - å±äº core å±‚
  
- `app/file_upload.py` â†’ `app/services/file_upload_service.py`
  - ä¸šåŠ¡æœåŠ¡ä»£ç 
  - åŒ…å« FileUploadService ç±»
  - å±äº services å±‚

**2. æµ‹è¯•æ–‡ä»¶ç§»åŠ¨ï¼ˆä¸¥æ ¼é•œåƒ app/ ç»“æ„ï¼‰**
- `tests/unit/test_error_handlers.py` â†’ `tests/unit/core/test_error_handlers.py`
- `tests/unit/test_file_upload.py` â†’ `tests/unit/services/test_file_upload_service.py`
- `tests/unit/test_file_upload_advanced.py` â†’ `tests/unit/services/test_file_upload_service_advanced.py`
- `tests/unit/test_file_upload_file_read_failures.py` â†’ `tests/unit/services/test_file_upload_service_file_read_failures.py`

**3. å¯¼å…¥å¼•ç”¨æ›´æ–°**
- æ›´æ–°äº†æ‰€æœ‰æ–‡ä»¶ä¸­çš„å¯¼å…¥è¯­å¥ï¼ˆ13ä¸ªæ–‡ä»¶ï¼‰
- `from app.error_handlers` â†’ `from app.core.error_handlers`
- `from app.file_upload` â†’ `from app.services.file_upload_service`

**4. Mock è·¯å¾„æ›´æ–°**
- æ‰¹é‡æ›´æ–°æµ‹è¯•ä¸­çš„ patch è·¯å¾„
- `patch('app.file_upload.xxx')` â†’ `patch('app.services.file_upload_service.xxx')`
- `patch('app.error_handlers.xxx')` â†’ `patch('app.core.error_handlers.xxx')`

**5. é…ç½®æ–‡ä»¶è·¯å¾„ä¿®å¤**
- ä¿®å¤ `app/core/error_handlers.py` ä¸­çš„ `ERROR_MESSAGES_FILE` è·¯å¾„
- ä» `app/core/` æ­£ç¡®æŒ‡å‘ `app/error_messages.json`

#### ä¼˜åŒ–åçš„ç»“æ„

```
app/
â”œâ”€â”€ main.py                    # åº”ç”¨å…¥å£
â”œâ”€â”€ __init__.py                # åŒ…åˆå§‹åŒ–
â”œâ”€â”€ __version__.py             # ç‰ˆæœ¬ä¿¡æ¯
â”œâ”€â”€ error_messages.json        # é”™è¯¯æ¶ˆæ¯é…ç½®
â”œâ”€â”€ core/                      # æ ¸å¿ƒåŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ error_handlers.py      # âœ¨ ç§»åŠ¨åˆ°è¿™é‡Œ
â”‚   â”œâ”€â”€ config.py
â”‚   â”œâ”€â”€ database.py
â”‚   â””â”€â”€ security.py
â””â”€â”€ services/                  # ä¸šåŠ¡æœåŠ¡å±‚
    â”œâ”€â”€ file_upload_service.py # âœ¨ ç§»åŠ¨åˆ°è¿™é‡Œ
    â”œâ”€â”€ auth_service.py
    â””â”€â”€ user_service.py
```

#### æµ‹è¯•éªŒè¯
- âœ… 196 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡
- âœ… æ‰€æœ‰å¯¼å…¥å¼•ç”¨æ­£ç¡®æ›´æ–°
- âœ… Mock è·¯å¾„å…¨éƒ¨ä¿®å¤

#### ç›¸å…³æ–‡ä»¶
- `app/core/error_handlers.py` - é”™è¯¯å¤„ç†æ¨¡å—
- `app/services/file_upload_service.py` - æ–‡ä»¶ä¸Šä¼ æœåŠ¡
- `tests/unit/core/test_error_handlers.py` - é”™è¯¯å¤„ç†æµ‹è¯•
- `tests/unit/services/test_file_upload_service*.py` - æ–‡ä»¶ä¸Šä¼ æµ‹è¯•

---

## 2026-02-22 - ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿå®Œå–„

### ç®€åŒ–ç‰ˆæœ¬å·æ›´æ–°æµç¨‹ âœ¨

#### é—®é¢˜
- ä¹‹å‰éœ€è¦åœ¨ä¸¤ä¸ªåœ°æ–¹æ›´æ–°ç‰ˆæœ¬å·ï¼š`app/__version__.py` å’Œ `pyproject.toml`
- å®¹æ˜“å¿˜è®°åŒæ­¥ï¼Œå¯¼è‡´ç‰ˆæœ¬å·ä¸ä¸€è‡´
- ä¸ç¬¦åˆå•ä¸€æ¥æºåŸåˆ™ï¼ˆSingle Source of Truthï¼‰

#### è§£å†³æ–¹æ¡ˆ

**1. é…ç½®åŠ¨æ€ç‰ˆæœ¬å·**
- ä¿®æ”¹ `pyproject.toml` ä½¿ç”¨ `dynamic = ["version"]`
- æ·»åŠ  `[tool.setuptools.dynamic]` é…ç½®ä» `app.__version__.__version__` è¯»å–
- æ·»åŠ  `[build-system]` é…ç½®æ”¯æŒ setuptools

**2. æ›´æ–°æ–‡æ¡£**
- æ›´æ–° `docs/ç‰ˆæœ¬ç®¡ç†.md`ï¼š
  - å¼ºè°ƒåªéœ€ä¿®æ”¹ `app/__version__.py` ä¸€ä¸ªæ–‡ä»¶
  - ç®€åŒ–æ›´æ–°æµç¨‹è¯´æ˜
  - æ ‡è®°æ—§æ–¹æ³•ä¸ºå·²åºŸå¼ƒ
  - ä¿®æ­£æ–‡æ¡£åº•éƒ¨çš„å½“å‰ç‰ˆæœ¬å·ï¼ˆ1.0.0 â†’ 2.0.0ï¼‰

**3. åˆ›å»ºç‰ˆæœ¬æ£€æŸ¥å·¥å…·**
- æ–°å¢ `scripts/python/check_version.py` è„šæœ¬
- éªŒè¯ç‰ˆæœ¬å·é…ç½®æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥æ‰€æœ‰ä½ç½®çš„ç‰ˆæœ¬å·æ˜¯å¦ä¸€è‡´
- æ˜¾ç¤ºç‰ˆæœ¬å†å²è®°å½•

**4. æ›´æ–°è„šæœ¬æ–‡æ¡£**
- æ›´æ–° `scripts/è„šæœ¬è¯´æ˜.md` æ·»åŠ  `check_version.py` è¯´æ˜
- æ›´æ–°ç›®å½•ç»“æ„åŒ…å«æ–°è„šæœ¬

#### ä¼˜åŒ–æ•ˆæœ

**ä¹‹å‰**ï¼šéœ€è¦ä¿®æ”¹ä¸¤ä¸ªæ–‡ä»¶
```python
# app/__version__.py
__version__ = "1.1.0"

# pyproject.toml
[project]
version = "1.1.0"  # â† éœ€è¦æ‰‹åŠ¨åŒæ­¥
```

**ç°åœ¨**ï¼šåªéœ€ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶ âœ¨
```python
# app/__version__.py
__version__ = "1.1.0"  # â† åªéœ€ä¿®æ”¹è¿™é‡Œï¼

# pyproject.toml
[project]
dynamic = ["version"]  # â† è‡ªåŠ¨ä» __version__.py è¯»å–
```

#### ä½¿ç”¨æ–¹æ³•

**æ›´æ–°ç‰ˆæœ¬å·**ï¼š
```bash
# åªéœ€ç¼–è¾‘ä¸€ä¸ªæ–‡ä»¶
vim app/__version__.py
```

**éªŒè¯ç‰ˆæœ¬å·**ï¼š
```bash
# è¿è¡Œæ£€æŸ¥è„šæœ¬
python scripts/python/check_version.py
```

#### ç›¸å…³æ–‡ä»¶
- `app/__version__.py` - å”¯ä¸€çš„ç‰ˆæœ¬å·å®šä¹‰ä½ç½®
- `pyproject.toml` - åŠ¨æ€ç‰ˆæœ¬å·é…ç½®
- `docs/ç‰ˆæœ¬ç®¡ç†.md` - ç‰ˆæœ¬ç®¡ç†æŒ‡å—
- `scripts/python/check_version.py` - ç‰ˆæœ¬æ£€æŸ¥å·¥å…·
- `scripts/è„šæœ¬è¯´æ˜.md` - è„šæœ¬ä½¿ç”¨è¯´æ˜

---

## 2026-02-22 - Tests ç›®å½•ç»“æ„ä¼˜åŒ–

### Tests ç›®å½•ç»“æ„ä¼˜åŒ– ğŸ“

#### é—®é¢˜
- `tests/unit/` æ ¹ç›®å½•ä¸‹æœ‰å¤šä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œæœªä¸¥æ ¼é•œåƒ `app/` ç»“æ„
- ç¼ºå°‘ `tests/unit/api/` ç›®å½•
- æµ‹è¯•è¾…åŠ©å·¥å…·çš„æµ‹è¯•æ–‡ä»¶æ··åœ¨ `tests/unit/` ä¸­
- ç›®å½•ç»“æ„ä¸å¤Ÿæ¸…æ™°ï¼Œä¸åˆ©äºç»´æŠ¤

#### è§£å†³æ–¹æ¡ˆ

**1. åˆ›å»ºæ–°ç›®å½•**
- åˆ›å»º `tests/unit/api/` ç›®å½•ç”¨äº API å±‚æµ‹è¯•

**2. ç§»åŠ¨æµ‹è¯•æ–‡ä»¶**ï¼ˆä¸¥æ ¼é•œåƒ `app/` ç»“æ„ï¼‰
- `test_security.py` â†’ `tests/unit/core/test_security.py`ï¼ˆå¯¹åº” `app/core/security.py`ï¼‰
- `test_deps.py` â†’ `tests/unit/api/test_deps.py`ï¼ˆå¯¹åº” `app/api/deps.py`ï¼‰
- `test_avatar.py` â†’ `tests/unit/utils/test_avatar.py`ï¼ˆå¯¹åº” `app/utils/avatar.py`ï¼‰
- `test_websocket_client_helper.py` â†’ `tests/test_helpers/test_websocket_client_helper.py`ï¼ˆæµ‹è¯•è¾…åŠ©å·¥å…·çš„æµ‹è¯•ï¼‰

**3. ä¿ç•™åœ¨æ ¹ç›®å½•çš„æ–‡ä»¶**ï¼ˆå¯¹åº” `app/` æ ¹ç›®å½•ï¼‰
- `test_main.py` - å¯¹åº” `app/main.py`
- `test_error_handlers.py` - å¯¹åº” `app/error_handlers.py`
- `test_file_upload*.py` (3ä¸ªæ–‡ä»¶) - å¯¹åº” `app/file_upload.py`
- `test_persona_validation.py` - å¯¹åº” `app/file_upload.py` çš„äººè®¾å¡éªŒè¯åŠŸèƒ½

**4. æ›´æ–°æ–‡æ¡£**
- æ›´æ–° `tests/docs/æµ‹è¯•è¯´æ˜.md` åæ˜ æ–°çš„ç›®å½•ç»“æ„
- æ›´æ–° `README.md` ä¸­çš„æµ‹è¯•ç›®å½•ç»“æ„è¯´æ˜
- æ›´æ–° `docs/æ¶æ„æ–‡æ¡£.md` ä¸­çš„æµ‹è¯•ç›®å½•ç»“æ„
- æ›´æ–° `docs/é¡¹ç›®æ•´ç†æ€»ç»“.md` è®°å½•æœ¬æ¬¡ä¼˜åŒ–

**5. æ¸…ç†ç¼“å­˜**
- åˆ é™¤ `tests/unit/__pycache__/` ä¸­çš„è¿‡æ—¶ç¼“å­˜æ–‡ä»¶

#### ä¼˜åŒ–åçš„ç›®å½•ç»“æ„
```
tests/
â”œâ”€â”€ unit/                         # å•å…ƒæµ‹è¯•ï¼ˆä¸¥æ ¼é•œåƒ app/ ç»“æ„ï¼‰
â”‚   â”œâ”€â”€ api/                      # API å±‚æµ‹è¯• âœ¨ æ–°å¢
â”‚   â”‚   â””â”€â”€ test_deps.py
â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒæ¨¡å—æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_database.py
â”‚   â”‚   â””â”€â”€ test_security.py      # âœ¨ ç§»åŠ¨
â”‚   â”œâ”€â”€ services/                 # æœåŠ¡å±‚æµ‹è¯•
â”‚   â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°æµ‹è¯•
â”‚   â”‚   â””â”€â”€ test_avatar.py        # âœ¨ ç§»åŠ¨
â”‚   â”œâ”€â”€ test_main.py              # åº”ç”¨ä¸»å…¥å£æµ‹è¯•
â”‚   â”œâ”€â”€ test_error_handlers.py   # é”™è¯¯å¤„ç†å™¨æµ‹è¯•
â”‚   â””â”€â”€ test_file_upload*.py     # æ–‡ä»¶ä¸Šä¼ ç›¸å…³æµ‹è¯•
â”œâ”€â”€ test_helpers/                 # æµ‹è¯•è¾…åŠ©å·¥å…·çš„æµ‹è¯•
â”‚   â””â”€â”€ test_websocket_client*.py # âœ¨ ç§»åŠ¨
â”œâ”€â”€ helpers/                      # æµ‹è¯•è¾…åŠ©å·¥å…·ï¼ˆä¾›æµ‹è¯•ä½¿ç”¨ï¼‰
â”œâ”€â”€ integration/                  # é›†æˆæµ‹è¯•
â””â”€â”€ property/                     # å±æ€§æµ‹è¯•
```

#### æ”¹è¿›æ•ˆæœ
- âœ… **ç»“æ„æ¸…æ™°**: `tests/unit/` ä¸¥æ ¼é•œåƒ `app/` ç›®å½•ç»“æ„
- âœ… **æ˜“äºæŸ¥æ‰¾**: æ ¹æ®ä¸šåŠ¡ä»£ç è·¯å¾„å¿«é€Ÿæ‰¾åˆ°å¯¹åº”æµ‹è¯•
- âœ… **æ˜“äºç»´æŠ¤**: æ–°å¢æµ‹è¯•æ–‡ä»¶æœ‰æ˜ç¡®çš„æ”¾ç½®ä½ç½®
- âœ… **åˆ†ç±»æ˜ç¡®**: æµ‹è¯•è¾…åŠ©å·¥å…·çš„æµ‹è¯•ç‹¬ç«‹åœ¨ `test_helpers/` ç›®å½•

#### æµ‹è¯•éªŒè¯
- âœ… 963ä¸ªå•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡
- âœ… å¯¼å…¥è·¯å¾„è‡ªåŠ¨æ›´æ–°ï¼ˆä½¿ç”¨ smartRelocateï¼‰
- âœ… æ‰€æœ‰ç›¸å…³æ–‡æ¡£å·²æ›´æ–°

**æ–‡ä»¶**ï¼š
- `tests/unit/api/test_deps.py`ï¼ˆæ–°å¢ç›®å½•ï¼‰
- `tests/unit/core/test_security.py`ï¼ˆç§»åŠ¨ï¼‰
- `tests/unit/utils/test_avatar.py`ï¼ˆç§»åŠ¨ï¼‰
- `tests/test_helpers/test_websocket_client_helper.py`ï¼ˆç§»åŠ¨ï¼‰
- `tests/docs/æµ‹è¯•è¯´æ˜.md`ï¼ˆæ›´æ–°ï¼‰
- `README.md`ï¼ˆæ›´æ–°ï¼‰
- `docs/æ¶æ„æ–‡æ¡£.md`ï¼ˆæ›´æ–°ï¼‰
- `docs/é¡¹ç›®æ•´ç†æ€»ç»“.md`ï¼ˆæ›´æ–°ï¼‰

---

## 2025-02-20 - æµ‹è¯•æ€§èƒ½ä¼˜åŒ–å’Œæ–‡æ¡£æ›´æ–°

### æµ‹è¯•æ€§èƒ½ä¼˜åŒ– âš¡

#### 1. bcrypt å¯†ç å“ˆå¸Œä¼˜åŒ–

**é—®é¢˜**ï¼š
- æµ‹è¯•æ‰§è¡Œé€Ÿåº¦è¿‡æ…¢ï¼šå®Œæ•´æµ‹è¯•å¥—ä»¶éœ€è¦ 451 ç§’ï¼ˆ7åˆ†31ç§’ï¼‰
- æ ¹æœ¬åŸå› ï¼šbcrypt é»˜è®¤ä½¿ç”¨ 12 roundsï¼Œæ¯æ¬¡å¯†ç å“ˆå¸Œéœ€è¦ ~0.5 ç§’
- å½±å“ï¼š1366 ä¸ªæµ‹è¯•ä¸­å¤§é‡æ¶‰åŠå¯†ç æ“ä½œï¼Œç´¯ç§¯æ•ˆåº”æ˜¾è‘—

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åœ¨æµ‹è¯•ç¯å¢ƒä¸­é™ä½ bcrypt rounds ä» 12 åˆ° 4
- é€šè¿‡é…ç½®æ–‡ä»¶ `tests/.test_env` ä¸­çš„ `PASSLIB_BCRYPT_ROUNDS` æ§åˆ¶
- ç”Ÿäº§ç¯å¢ƒä»ä½¿ç”¨ 12 roundsï¼ˆé»˜è®¤å€¼ï¼‰

**å®ç°ä½ç½®**ï¼š
- `tests/.test_env`ï¼šé…ç½® `PASSLIB_BCRYPT_ROUNDS=4`
- `tests/.test_env.template`ï¼šé…ç½®æ¨¡æ¿
- `tests/conftest.py`ï¼šä»é…ç½®æ–‡ä»¶è¯»å–å¹¶è®¾ç½®ç¯å¢ƒå˜é‡
- `app/core/security.py`ï¼šè¯»å–ç¯å¢ƒå˜é‡é…ç½® bcrypt rounds

**ä¼˜åŒ–æ•ˆæœ**ï¼š
- å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼š451s â†’ 21.31sï¼ˆ**æå‡ 21å€**ï¼‰
- å•ä¸ªè®¤è¯æµ‹è¯•æ–‡ä»¶ï¼š10.06s â†’ 1.36sï¼ˆ**æå‡ 7.4å€**ï¼‰
- å•ä¸ªç™»å½•æµ‹è¯•ï¼š0.56s â†’ 0.09sï¼ˆ**æå‡ 6.2å€**ï¼‰

**å®‰å…¨æ€§è¯´æ˜**ï¼š
- æµ‹è¯•ç¯å¢ƒä½¿ç”¨ 4 rounds ä¸å½±å“å®‰å…¨æ€§
- ç”Ÿäº§ç¯å¢ƒä¿æŒ 12 rounds çš„é«˜å®‰å…¨æ€§
- ä»…åœ¨æµ‹è¯•æ—¶é™ä½ roundsï¼Œä¸å½±å“å®é™…éƒ¨ç½²

**æ–‡ä»¶**ï¼š
- `tests/.test_env`
- `tests/.test_env.template`
- `tests/conftest.py`
- `app/core/security.py`
- `docs/testing/TEST_PERFORMANCE_OPTIMIZATION.md`ï¼ˆæ–°å¢ï¼‰

### æ–‡æ¡£æ›´æ–°

#### 1. æµ‹è¯•æ–‡æ¡£æ›´æ–° (TESTING.md)

**æ›´æ–°å†…å®¹**ï¼š
- æ›´æ–°æµ‹è¯•ç»Ÿè®¡æ•°æ®ï¼šä» 753 ä¸ªæµ‹è¯•å¢åŠ åˆ° 1366 ä¸ªæµ‹è¯•
- æ›´æ–°æµ‹è¯•é€šè¿‡ç‡ï¼šä» 745 é€šè¿‡å¢åŠ åˆ° 1355 é€šè¿‡
- æ›´æ–°å¤±è´¥æµ‹è¯•æ•°ï¼šä» 7 ä¸ªå¤±è´¥å‡å°‘åˆ° 10 ä¸ªå¤±è´¥ï¼ˆä½†æ€»æ•°å¢åŠ æ˜¯å› ä¸ºæ–°å¢äº†æ›´å¤šæµ‹è¯•ï¼‰
- æ›´æ–°æµ‹è¯•æ‰§è¡Œæ—¶é—´ï¼šä» 162 ç§’å¢åŠ åˆ° 451 ç§’ï¼ˆç”±äºæµ‹è¯•æ•°é‡å¢åŠ ï¼‰
- æ›´æ–°æµ‹è¯•è´¨é‡è¯„åˆ†ï¼šä» 8.7/10 è°ƒæ•´åˆ° 8.5/10
- æ›´æ–°æ”¹è¿›å»ºè®®ï¼šé’ˆå¯¹æ–°çš„å¤±è´¥æµ‹è¯•ç±»å‹ï¼ˆdeps å’Œ error_handlersï¼‰

**æ–‡ä»¶**ï¼š`docs/TESTING.md`

**å…³é”®å˜åŒ–**ï¼š
- æµ‹è¯•æ•°é‡å¢åŠ äº† 81%ï¼ˆä» 753 â†’ 1366ï¼‰
- æµ‹è¯•è¦†ç›–ç‡ä¿æŒåœ¨ 79%
- æ–°å¢çš„å¤±è´¥æµ‹è¯•ä¸»è¦é›†ä¸­åœ¨ä¾èµ–æ³¨å…¥å’Œé”™è¯¯å¤„ç†æ¨¡å—

### æ–‡ä»¶ç»“æ„ä¼˜åŒ–

#### 1. ç¿»è¯‘å­—å…¸æ–‡ä»¶æ•´åˆ

**é—®é¢˜**ï¼š
- é¡¹ç›®ä¸­å­˜åœ¨ä¸‰ä¸ªç›¸åŒçš„ `translation_dict.json` æ–‡ä»¶å‰¯æœ¬
  - `./translation_dict.json` (æ ¹ç›®å½•)
  - `./app/translation_dict.json`
  - `./app/api/translation_dict.json`
- æ‰€æœ‰ä¸‰ä¸ªæ–‡ä»¶å†…å®¹å®Œå…¨ç›¸åŒï¼ˆMD5: `b795659f2585f4d87cacb84f2135ddbb`ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä¿ç•™å”¯ä¸€çš„è§„èŒƒä½ç½®ï¼š`./app/api/translation_dict.json`
- åˆ é™¤äº†æ ¹ç›®å½•å’Œ `app/` ç›®å½•ä¸‹çš„é‡å¤å‰¯æœ¬
- ä»£ç å·²æ­£ç¡®å¼•ç”¨è§„èŒƒä½ç½®ï¼ˆ`app/api/routes/dictionary.py`ï¼‰
- æ‰€æœ‰ç›¸å…³æµ‹è¯•é€šè¿‡éªŒè¯ï¼ˆ10/10 æµ‹è¯•é€šè¿‡ï¼‰

**å½±å“**ï¼š
- å‡å°‘äº†é¡¹ç›®ä¸­çš„å†—ä½™æ–‡ä»¶
- ç®€åŒ–äº†æ–‡ä»¶ç»´æŠ¤
- ä¸å½±å“åŠŸèƒ½ï¼ˆæ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼‰

**æ–‡ä»¶**ï¼š
- åˆ é™¤ï¼š`./translation_dict.json`
- åˆ é™¤ï¼š`./app/translation_dict.json`
- ä¿ç•™ï¼š`./app/api/translation_dict.json`

---

## 2025-02-20 - æ–‡æ¡£å’Œæ¶æ„æ›´æ–°

### æ–‡æ¡£æ›´æ–°

#### 1. API æ–‡æ¡£å®Œå…¨é‡å†™

**æ›´æ–°å†…å®¹**ï¼š
- æ›´æ–°äº†åŸºç¡€ä¿¡æ¯å’Œé¡¹ç›®æ¶æ„è¯´æ˜
- å®Œæ•´çš„æ¥å£åˆ†ç±»å’Œè¯´æ˜
- æ·»åŠ äº†æ‰€æœ‰ 10 ä¸ªè·¯ç”±æ¨¡å—çš„æ¥å£æ–‡æ¡£
- æ–°å¢è¯„è®ºæ¥å£æ–‡æ¡£ï¼ˆåˆ›å»ºã€åˆ—è¡¨ã€ç‚¹èµ/ç‚¹è¸©ã€åˆ é™¤ï¼‰
- æ–°å¢æ”¶è—æ¥å£æ–‡æ¡£
- æ–°å¢ç®¡ç†å‘˜æ¥å£æ–‡æ¡£
- æ–°å¢ WebSocket æ¥å£æ–‡æ¡£
- ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼è¯´æ˜
- å¸¸è§é”™è¯¯ç è¡¨
- è®¤è¯å’Œæƒé™è¯´æ˜

**æ–‡ä»¶**ï¼š`docs/API.md`

#### 2. æ•°æ®åº“æ¨¡å‹æ–‡æ¡£æ›´æ–°

**æ›´æ–°å†…å®¹**ï¼š
- æ›´æ–°äº†æ–‡ä»¶è·¯å¾„ï¼ˆä» `database_models.py` æ”¹ä¸º `app/models/database.py`ï¼‰
- æ·»åŠ äº† `is_super_admin` å­—æ®µè¯´æ˜
- æ·»åŠ äº† `version` å­—æ®µè¯´æ˜ï¼ˆçŸ¥è¯†åº“å’Œäººè®¾å¡ï¼‰
- æ·»åŠ äº† `DownloadRecord` æ¨¡å‹è¯´æ˜
- æ·»åŠ äº† `Comment` å’Œ `CommentReaction` æ¨¡å‹è¯´æ˜
- æ˜ç¡®è¯´æ˜äº†**æ— ç‰©ç†å¤–é”®è®¾è®¡**
- æ›´æ–°äº†ç»´æŠ¤å»ºè®®

**æ–‡ä»¶**ï¼š`docs/database/models.md`

#### 3. Alembic è¿ç§»æŒ‡å—æ›´æ–°

**æ›´æ–°å†…å®¹**ï¼š
- æ›´æ–°äº†æ–‡ä»¶è·¯å¾„å’Œé…ç½®è¯´æ˜
- æ·»åŠ äº†é¡¹ç›®é…ç½®ç°çŠ¶è¯´æ˜
- æ·»åŠ äº†å¸¸ç”¨å‘½ä»¤å‚è€ƒ
- æ”¹è¿›äº†æ—¥å¸¸å¼€å‘æµç¨‹è¯´æ˜
- æ›´æ–°äº†å¤šæ•°æ®åº“æ”¯æŒè¯´æ˜
- æ·»åŠ äº†é—®é¢˜æ’æŸ¥è¡¨

**æ–‡ä»¶**ï¼š`docs/database/Alembic_migration_guide.md`

#### 4. æ¶æ„æ–‡æ¡£æ›´æ–°

**æ›´æ–°å†…å®¹**ï¼š
- æ›´æ–°äº†ç›®å½•ç»“æ„ï¼ˆæ·»åŠ äº†æ–°çš„æ–‡ä»¶å’Œç›®å½•ï¼‰
- æ›´æ–°äº†æµ‹è¯•ç›®å½•ç»“æ„ï¼ˆpropertyã€unitã€integrationï¼‰
- æ›´æ–°äº†æ•°æ®æ¨¡å‹è¯´æ˜ï¼ˆ12 ä¸ªè¡¨çš„å®Œæ•´è¯´æ˜ï¼‰
- æ›´æ–°äº†æ¨¡å‹å…³ç³»å›¾
- æ˜ç¡®è¯´æ˜äº†**æ— ç‰©ç†å¤–é”®è®¾è®¡**
- æ›´æ–°äº†ç›¸å…³æ–‡æ¡£é“¾æ¥

**æ–‡ä»¶**ï¼š`docs/ARCHITECTURE.md`

### é¡¹ç›®ç»“æ„ä¼˜åŒ–

#### 1. æ–‡æ¡£ç›®å½•æ¸…ç†

**åˆ é™¤çš„æ–‡ä»¶**ï¼š
- ä¸´æ—¶æŠ¥å‘Šï¼šCLEANUP_SUMMARYã€COVERAGE_PROGRESS_REPORTã€FINAL_COVERAGE_REPORTã€TEST_FIXES_SUMMARYã€test_quality_report
- ä¸­æ–‡æ›´æ–°æ€»ç»“ï¼šCHANGELOG_CN
- TODO åˆ—è¡¨
- æµ‹è¯•å’Œè„šæœ¬çš„å­ç›®å½•

**ä¿ç•™çš„æ–‡ä»¶**ï¼š
- æ ¸å¿ƒæ–‡æ¡£ï¼šAPI.mdã€ARCHITECTURE.mdã€CHANGELOG.mdã€TESTING.mdã€README_ERROR_CODES.md
- æ•°æ®åº“æ–‡æ¡£ï¼šmodels.mdã€Alembic_migration_guide.md
- Postman é›†åˆ

#### 2. ç¼“å­˜å’Œä¸´æ—¶æ–‡ä»¶æ¸…ç†

**åˆ é™¤çš„ç›®å½•**ï¼š
- `__pycache__/` - Python ç¼“å­˜
- `.pytest_cache/` - Pytest ç¼“å­˜
- `htmlcov/` - è¦†ç›–ç‡ HTML æŠ¥å‘Š

**åˆ é™¤çš„æ–‡ä»¶**ï¼š
- `.coverage` - è¦†ç›–ç‡æ•°æ®
- `coverage.json` - è¦†ç›–ç‡ JSON
- `test.db` - æµ‹è¯•æ•°æ®åº“
- `check_password.py` - æ ¹ç›®å½•è„šæœ¬
- å…¶ä»–ä¸´æ—¶æ–‡ä»¶

### æ•°æ®åº“è®¾è®¡è¯´æ˜

#### æ— ç‰©ç†å¤–é”®è®¾è®¡

é¡¹ç›®é‡‡ç”¨**æ— ç‰©ç†å¤–é”®è®¾è®¡**ï¼Œæ‰€æœ‰å…³ç³»å‡é€šè¿‡åº”ç”¨å±‚ç»´æŠ¤ï¼š

**ä¼˜ç‚¹**ï¼š
- çµæ´»æ€§é«˜ï¼Œå¯ä»¥è½»æ¾ä¿®æ”¹å…³ç³»
- æ•°æ®åº“è¿ç§»æ›´ç®€å•
- æ”¯æŒå¤šæ•°æ®åº“åˆ‡æ¢

**ç¼ºç‚¹**ï¼š
- åº”ç”¨å±‚å¿…é¡»ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- åˆ é™¤æ“ä½œéœ€è¦æ‰‹åŠ¨å¤„ç†çº§è”åˆ é™¤
- éœ€è¦æ›´è°¨æ…çš„ä¸šåŠ¡é€»è¾‘è®¾è®¡

**å®ç°æ–¹å¼**ï¼š
- æ‰€æœ‰å…³ç³»é€šè¿‡ SQLAlchemy çš„ `relationship` å£°æ˜ï¼ˆé€»è¾‘å…³ç³»ï¼‰
- æ•°æ®åº“ä¸­ä¸åˆ›å»ºç‰©ç†å¤–é”®çº¦æŸ
- åº”ç”¨å±‚è´Ÿè´£ç»´æŠ¤æ•°æ®ä¸€è‡´æ€§

### å½±å“èŒƒå›´

**æ–‡æ¡£æ›´æ–°**ï¼š
- æ‰€æœ‰æ–‡æ¡£å·²åŒæ­¥åˆ°æœ€æ–°å®ç°
- æ–°å¢äº†å®Œæ•´çš„ API æ–‡æ¡£
- æ–°å¢äº†æ•°æ®åº“è¿ç§»æŒ‡å—
- æ›´æ–°äº†æ¶æ„æ–‡æ¡£

**é¡¹ç›®ç»“æ„**ï¼š
- æ–‡æ¡£ç›®å½•æ›´åŠ æ¸…æ™°
- åˆ é™¤äº†å¤§é‡ä¸´æ—¶æ–‡ä»¶
- é¡¹ç›®ä½“ç§¯å‡å°

### ç›¸å…³æ–‡ä»¶

- `docs/API.md` - API æ–‡æ¡£
- `docs/ARCHITECTURE.md` - æ¶æ„æ–‡æ¡£
- `docs/database/models.md` - æ•°æ®åº“æ¨¡å‹
- `docs/database/Alembic_migration_guide.md` - è¿ç§»æŒ‡å—

---

## 2025-12-01 - ç”¨æˆ·ä¸Šä¼ å†å²å’Œç»Ÿè®¡æ¥å£å¢å¼º

### æ–°å¢åŠŸèƒ½

#### 1. ç”¨æˆ·ä¸ªäººä¸Šä¼ å†å²æ¥å£

**æ–°å¢æ¥å£**ï¼š
- `GET /api/me/upload-history` - è·å–å½“å‰ç”¨æˆ·ä¸ªäººä¸Šä¼ å†å²è®°å½•

**åŠŸèƒ½è¯´æ˜**ï¼š
- æ”¯æŒåˆ†é¡µæŸ¥è¯¢ç”¨æˆ·ä¸Šä¼ è®°å½•
- è¿”å›çŸ¥è¯†åº“å’Œäººè®¾å¡çš„ä¸Šä¼ è®°å½•
- åŒ…å«çŠ¶æ€æ˜ å°„ï¼ˆapprovedâ†’successï¼Œpendingâ†’processingï¼Œrejectedâ†’failedï¼‰
- æä¾›ç›®æ ‡å­˜åœ¨æ€§æ£€æŸ¥å’Œæ–‡ä»¶å¤§å°ç»Ÿè®¡
- æ”¯æŒå…¼å®¹å‰ç«¯çš„å“åº”æ ¼å¼æ„å»º

**å®ç°ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`user_router.py`
- è¡Œå·ï¼šç¬¬1260-1320è¡Œ

#### 2. ç”¨æˆ·ä¸ªäººä¸Šä¼ ç»Ÿè®¡æ¥å£

**æ–°å¢æ¥å£**ï¼š
- `GET /api/me/upload-stats` - è·å–å½“å‰ç”¨æˆ·ä¸ªäººä¸Šä¼ ç»Ÿè®¡

**åŠŸèƒ½è¯´æ˜**ï¼š
- è·å–ç”¨æˆ·ä¸Šä¼ æ€»æ•°ã€æˆåŠŸæ•°ã€å¤„ç†ä¸­æ•°ã€å¤±è´¥æ•°
- è¿”å›åç«¯æ•°æ®åº“å­—æ®µåå’Œå‰ç«¯æœŸæœ›å­—æ®µåä¸¤ç§æ ¼å¼çš„ç»Ÿè®¡ç»“æœ
- æä¾›æˆåŠŸç‡å’Œæ–‡ä»¶å¤§å°ç»Ÿè®¡
- å…¼å®¹å‰ç«¯UIå±•ç¤ºéœ€æ±‚

**å®ç°ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`user_router.py`
- è¡Œå·ï¼šç¬¬1321-1380è¡Œ

### å½±å“èŒƒå›´

**æ–°å¢æ¥å£**ï¼ˆå®¢æˆ·ç«¯å¯é€‰é›†æˆï¼‰ï¼š
- `GET /api/me/upload-history` - ç”¨æˆ·ä¸ªäººä¸Šä¼ å†å²è®°å½•
- `GET /api/me/upload-stats` - ç”¨æˆ·ä¸ªäººä¸Šä¼ ç»Ÿè®¡

**åŠŸèƒ½å½±å“**ï¼š
- ç”¨æˆ·ç°åœ¨å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„ä¸Šä¼ å†å²å’Œç»Ÿè®¡æ•°æ®
- ä¸ç°æœ‰çš„ç®¡ç†å‘˜ä¸Šä¼ å†å²å’Œç»Ÿè®¡æ¥å£å½¢æˆäº’è¡¥
- æä¾›ä¸ªäººç»´åº¦çš„ä¸Šä¼ ç®¡ç†èƒ½åŠ›

### ç›¸å…³æ–‡ä»¶

- `user_router.py` - ç”¨æˆ·è·¯ç”±å®ç°
- `database_models.py` - æ•°æ®åº“æ¨¡å‹ï¼ˆUploadRecordè¡¨ï¼‰

---

## 2025-11-25 - å†…å®¹å­—æ®µå…¥åº“ä¸åˆ—è¡¨èƒ½åŠ›å¢å¼º

### åŠŸèƒ½ / æ¥å£
- çŸ¥è¯†åº“ä¸äººè®¾å¡ä¸Šä¼ æ–°å¢æ­£æ–‡ `content`ã€æ ‡ç­¾ `tags`ï¼Œå“åº”å¸¦ä½œè€…ä¿¡æ¯ã€æ–‡ä»¶åˆ—è¡¨ä¸å¤§å°èšåˆï¼Œåˆ é™¤æœ€åä¸€ä¸ªæ–‡ä»¶æ—¶è‡ªåŠ¨åˆ é™¤æ•´æ¡çŸ¥è¯†åº“ï¼ˆè¿”å› `knowledge_deleted` æ ‡è¯†ï¼‰
- ç”¨æˆ·ä¸Šä¼ è®°å½•ï¼ˆçŸ¥è¯†åº“ã€äººè®¾å¡ï¼‰æ”¯æŒåˆ†é¡µã€åç§°/æ ‡ç­¾/çŠ¶æ€ç­›é€‰ä¸å¤šå­—æ®µæ’åºï¼Œç®¡ç†å‘˜/å®¡æ ¸å‘˜å¯æŸ¥çœ‹ä»–äººè®°å½•
- ç”¨æˆ·æ”¶è—åˆ—è¡¨åˆ†é¡µåŒ–ï¼Œæ”¯æŒç±»å‹è¿‡æ»¤å’Œåˆ›å»ºæ—¶é—´/æ”¶è—æ•°æ’åºï¼Œè¿”å› `items/total/page/page_size` ç»“æ„
- ç®¡ç†ç«¯å†…å®¹åˆ—è¡¨æ–°å¢ä¸Šä¼ è€…ï¼ˆID/ç”¨æˆ·åæ¨¡ç³Šï¼‰ç­›é€‰ä¸æ’åºå­—æ®µ/æ–¹å‘å‚æ•°ï¼Œæ—¥å¿—è¾“å‡ºè¡¥å……ä¸Šä¸‹æ–‡
- ä¸Šä¼ /ä¸‹è½½ç›¸å…³ CORS æš´éœ² `Content-Disposition` å¤´ï¼Œå‰ç«¯å¯è¯»å–æ–‡ä»¶å

### æ¨¡å‹ / å­˜å‚¨
- `KnowledgeBase`ã€`PersonaCard` æ¨¡å‹æ–°å¢ `content`ã€`tags` å­—æ®µï¼›è¿”å›çš„ä½œè€…å­—æ®µå›è½åˆ°ç‰ˆæƒäºº/ä¸Šä¼ è€…
- SQLite è¿ç§»è¡¥å…… `content`ã€`tags` åˆ—å¹¶åœ¨ä¿å­˜å‰ç»Ÿä¸€å°†æ ‡ç­¾åˆ—è¡¨è½¬é€—å·å­—ç¬¦ä¸²

### æ–‡æ¡£
- API æ–‡æ¡£è¡¥å…… content/tags ä¼ å‚ã€ç”¨æˆ·ä¸Šä¼ /æ”¶è—åˆ†é¡µå‚æ•°ä¸å“åº”ã€åˆ é™¤æ–‡ä»¶è¿”å›å­—æ®µã€ç®¡ç†ç«¯ç­›é€‰ä¸æ’åºå‚æ•°ç¤ºä¾‹
- README/TODO åŒæ­¥ä¸Šè¿°è¡Œä¸ºä¸å®ŒæˆçŠ¶æ€

---

## 2025-11-24 - ç”¨æˆ·åŠŸèƒ½å’Œç®¡ç†å‘˜åŠŸèƒ½å¢å¼º

### æ–°å¢åŠŸèƒ½

#### 1. åˆ·æ–°ä»¤ç‰Œæœºåˆ¶

**æ–°å¢æ¥å£**ï¼š
- `POST /api/refresh` - åˆ·æ–°è®¿é—®ä»¤ç‰Œ

**åŠŸèƒ½è¯´æ˜**ï¼š
- ç™»å½•æ¥å£ç°åœ¨è¿”å› `refresh_token` å’Œ `expires_in` å­—æ®µ
- æ”¯æŒä½¿ç”¨åˆ·æ–°ä»¤ç‰Œè·å–æ–°çš„è®¿é—®ä»¤ç‰Œï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- è®¿é—®ä»¤ç‰Œæœ‰æ•ˆæœŸ15åˆ†é’Ÿï¼Œåˆ·æ–°ä»¤ç‰Œæœ‰æ•ˆæœŸæ›´é•¿

#### 2. ç”¨æˆ·å¤´åƒåŠŸèƒ½

**æ–°å¢æ¥å£**ï¼š
- `POST /api/users/me/avatar` - ä¸Šä¼ å¤´åƒ
- `DELETE /api/users/me/avatar` - åˆ é™¤å¤´åƒ
- `GET /api/users/{user_id}/avatar` - è·å–ç”¨æˆ·å¤´åƒ

**åŠŸèƒ½è¯´æ˜**ï¼š
- æ”¯æŒä¸Šä¼ ã€åˆ é™¤å’Œè·å–ç”¨æˆ·å¤´åƒ
- æ”¯æŒ JPGã€JPEGã€PNGã€GIFã€WEBP æ ¼å¼
- è‡ªåŠ¨ç”Ÿæˆç¼©ç•¥å›¾
- å¦‚æœç”¨æˆ·æ²¡æœ‰ä¸Šä¼ å¤´åƒï¼Œè¿”å›è‡ªåŠ¨ç”Ÿæˆçš„å¤´åƒ
- å¤´åƒæœ€å¤§ 2MBï¼Œæœ€å¤§å°ºå¯¸ 1024x1024 åƒç´ 

#### 3. ä¿®æ”¹å¯†ç åŠŸèƒ½

**æ–°å¢æ¥å£**ï¼š
- `PUT /api/users/me/password` - ä¿®æ”¹å¯†ç 

**åŠŸèƒ½è¯´æ˜**ï¼š
- æ”¯æŒç”¨æˆ·ä¿®æ”¹è‡ªå·±çš„å¯†ç 
- éœ€è¦æä¾›å½“å‰å¯†ç è¿›è¡ŒéªŒè¯
- å¯†ç ä¿®æ”¹åï¼Œæ‰€æœ‰ç°æœ‰Tokenå°†å¤±æ•ˆï¼ˆé€šè¿‡password_versionæœºåˆ¶ï¼‰
- å¸¦é€Ÿç‡é™åˆ¶ï¼šæ¯åˆ†é’Ÿæœ€å¤š5æ¬¡å°è¯•

#### 4. ç®¡ç†å‘˜åŠŸèƒ½å¢å¼º

**æ–°å¢æ¥å£**ï¼š
- `GET /api/admin/broadcast-messages` - è·å–å¹¿æ’­æ¶ˆæ¯ç»Ÿè®¡
- `GET /api/admin/stats` - è·å–ç³»ç»Ÿç»Ÿè®¡æ•°æ®
- `GET /api/admin/recent-users` - è·å–æœ€è¿‘æ³¨å†Œç”¨æˆ·
- `GET /api/admin/users` - è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µå’Œæœç´¢ï¼‰
- `PUT /api/admin/users/{user_id}/role` - æ›´æ–°ç”¨æˆ·è§’è‰²
- `DELETE /api/admin/users/{user_id}` - åˆ é™¤ç”¨æˆ·
- `POST /api/admin/users` - åˆ›å»ºæ–°ç”¨æˆ·
- `GET /api/admin/knowledge/all` - è·å–æ‰€æœ‰çŸ¥è¯†åº“ï¼ˆç®¡ç†å‘˜ï¼‰
- `GET /api/admin/persona/all` - è·å–æ‰€æœ‰äººè®¾å¡ï¼ˆç®¡ç†å‘˜ï¼‰
- `POST /api/admin/knowledge/{kb_id}/revert` - æ¢å¤çŸ¥è¯†åº“å®¡æ ¸çŠ¶æ€
- `POST /api/admin/persona/{pc_id}/revert` - æ¢å¤äººè®¾å¡å®¡æ ¸çŠ¶æ€
- `GET /api/admin/upload-history` - è·å–ä¸Šä¼ å†å²è®°å½•
- `GET /api/admin/upload-stats` - è·å–ä¸Šä¼ ç»Ÿè®¡æ•°æ®
- `DELETE /api/admin/uploads/{upload_id}` - åˆ é™¤ä¸Šä¼ è®°å½•
- `POST /api/admin/uploads/{upload_id}/reprocess` - é‡æ–°å¤„ç†ä¸Šä¼ 

### æ¥å£å˜æ›´

#### ç™»å½•æ¥å£å“åº”æ ¼å¼æ›´æ–°

**å˜æ›´å‰**ï¼š
```json
{
  "access_token": "...",
  "token_type": "bearer"
}
```

**å˜æ›´å**ï¼š
```json
{
  "access_token": "...",
  "refresh_token": "...",
  "token_type": "bearer",
  "expires_in": 900,
  "user": {
    "id": "...",
    "username": "...",
    "email": "...",
    "role": "..."
  }
}
```

---

## 2025-11-23 - æ–°å¢åŠŸèƒ½å’Œæ¥å£ä¼˜åŒ–

### æ–°å¢åŠŸèƒ½

#### 1. StarçŠ¶æ€æ£€æŸ¥æ¥å£

**æ–°å¢æ¥å£**ï¼š
- `GET /api/knowledge/{kb_id}/starred` - æ£€æŸ¥çŸ¥è¯†åº“æ˜¯å¦å·²è¢«å½“å‰ç”¨æˆ·Star
- `GET /api/persona/{pc_id}/starred` - æ£€æŸ¥äººè®¾å¡æ˜¯å¦å·²è¢«å½“å‰ç”¨æˆ·Star

**åŠŸèƒ½è¯´æ˜**ï¼š
- è¿”å›æ ¼å¼ï¼š`{"starred": true/false}`
- éœ€è¦ç”¨æˆ·è®¤è¯
- ç”¨äºå‰ç«¯å¿«é€Ÿæ£€æŸ¥StarçŠ¶æ€ï¼Œé¿å…è·å–æ‰€æœ‰Starè®°å½•

#### 2. åˆ†é¡µæ”¯æŒ

**æ–°å¢åˆ†é¡µæ¥å£**ï¼š
- `GET /api/knowledge/public` - æ”¯æŒåˆ†é¡µã€æœç´¢ã€ç­›é€‰å’Œæ’åº
- `GET /api/persona/public` - æ”¯æŒåˆ†é¡µã€æœç´¢ã€ç­›é€‰å’Œæ’åº

**æŸ¥è¯¢å‚æ•°**ï¼š
- `page`: é¡µç ï¼ˆä»1å¼€å§‹ï¼‰
- `page_size`: æ¯é¡µæ•°é‡ï¼ˆ1-100ï¼‰
- `name`: æŒ‰åç§°æœç´¢ï¼ˆå¯é€‰ï¼‰
- `uploader_id`: æŒ‰ä¸Šä¼ è€…IDç­›é€‰ï¼ˆå¯é€‰ï¼‰
- `sort_by`: æ’åºå­—æ®µï¼ˆcreated_at, updated_at, star_countï¼‰
- `sort_order`: æ’åºé¡ºåºï¼ˆasc, descï¼‰

#### 3. ç”¨æˆ·Starè®°å½•æ¥å£å¢å¼º

**æ¥å£**ï¼š`GET /api/user/stars`

**æ–°å¢å‚æ•°**ï¼š
- `includeDetails`: æ˜¯å¦åŒ…å«å®Œæ•´è¯¦æƒ…ï¼ˆå¯é€‰ï¼Œé»˜è®¤falseï¼‰

**åŠŸèƒ½è¯´æ˜**ï¼š
- å½“ `includeDetails=true` æ—¶ï¼Œè¿”å›Starè®°å½•çš„åŒæ—¶åŒ…å«çŸ¥è¯†åº“/äººè®¾å¡çš„å®Œæ•´ä¿¡æ¯
- å‡å°‘å‰ç«¯APIè°ƒç”¨æ¬¡æ•°ï¼Œä» 1+N æ¬¡è¯·æ±‚ä¼˜åŒ–åˆ° 1 æ¬¡è¯·æ±‚

---

## 2025-11-22 - API Bugä¿®å¤å’Œä¼˜åŒ–

### ä¿®å¤å†…å®¹

#### 1. å®¡æ ¸APIä¿®å¤ï¼ˆçŸ¥è¯†åº“å’Œäººè®¾å¡å®¡æ‰¹å¤±è´¥ï¼‰

**é—®é¢˜æè¿°**ï¼š
- `approve_knowledge_base`ã€`reject_knowledge_base`ã€`approve_persona_card` å’Œ `reject_persona_card` å››ä¸ªå®¡æ ¸APIåœ¨è°ƒç”¨ `save_knowledge_base` å’Œ `save_persona_card` æ—¶ä¼ çš„æ˜¯å¯¹è±¡ï¼Œä½†è¿™ä¸¤ä¸ªæ–¹æ³•æœŸæœ›å­—å…¸å‚æ•°ã€‚

**ä¿®å¤æ–¹æ³•**ï¼š
åœ¨è°ƒç”¨ `save_knowledge_base` å’Œ `save_persona_card` ä¹‹å‰ï¼Œç”¨ `to_dict()` æŠŠå¯¹è±¡è½¬æˆå­—å…¸ã€‚

#### 1.1. å®¡æ ¸æ‹’ç»APIå‚æ•°ä¼ é€’æ–¹å¼ä¼˜åŒ–

**é—®é¢˜æè¿°**ï¼š
- `reject_knowledge_base` å’Œ `reject_persona_card` æ¥å£çš„ `reason` å‚æ•°åŸæœ¬ä½¿ç”¨æŸ¥è¯¢å‚æ•°ï¼ˆQueryï¼‰ï¼Œä¸ç¬¦åˆRESTfulæœ€ä½³å®è·µã€‚

**ä¿®å¤æ–¹æ³•**ï¼š
å°† `reason` å‚æ•°ä»æŸ¥è¯¢å‚æ•°æ”¹ä¸ºè¯·æ±‚ä½“ï¼ˆBodyï¼‰ï¼Œä½¿ç”¨ `Body(..., embed=True)` æ¥æ”¶JSONæ ¼å¼çš„è¯·æ±‚ä½“ã€‚

#### 2. æ¶ˆæ¯å‘é€APIä¿®å¤ï¼ˆæ¶ˆæ¯åˆ›å»ºå¤±è´¥ï¼‰

**é—®é¢˜æè¿°**ï¼š
- `Message.to_dict()` æ–¹æ³•è¿”å›çš„ `created_at` å­—æ®µæ˜¯ ISO æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä½† `MessageResponse` Pydanticæ¨¡å‹æœŸæœ›æ¥æ”¶ `datetime` å¯¹è±¡ã€‚

**ä¿®å¤æ–¹æ³•**ï¼š
ä¿®æ”¹ `Message.to_dict()` æ–¹æ³•ï¼Œç¡®ä¿ `created_at` å­—æ®µè¿”å› `datetime` å¯¹è±¡è€Œä¸æ˜¯å­—ç¬¦ä¸²ã€‚

#### 3. æ¶ˆæ¯è·å–APIä¿®å¤ï¼ˆè·å–æ¶ˆæ¯åˆ—è¡¨å¤±è´¥ï¼‰

**é—®é¢˜æè¿°**ï¼š
- `api_routes.py` ä¸­å®šä¹‰äº†é‡å¤çš„ `MessageResponse` ç±»ï¼Œä¸ `models.py` ä¸­çš„å®šä¹‰ä¸ä¸€è‡´ã€‚

**ä¿®å¤æ–¹æ³•**ï¼š
ä» `models.py` å¯¼å…¥ `MessageResponse`ï¼Œåˆ é™¤ `api_routes.py` ä¸­é‡å¤çš„å®šä¹‰ã€‚

#### 4. æ¶ˆæ¯APIè¿›ä¸€æ­¥ä¿®å¤ï¼ˆæ‰¹é‡åˆ›å»ºå’ŒæŸ¥è¯¢ä¼˜åŒ–ï¼‰

**é—®é¢˜æè¿°**ï¼š
- `bulk_create_messages` æ–¹æ³•åœ¨å¼‚å¸¸æ—¶åªæ‰“å°é”™è¯¯å¹¶è¿”å›ç©ºåˆ—è¡¨
- SQLæŸ¥è¯¢ä¸­ä½¿ç”¨ `&` å’Œ `|` è¿ç®—ç¬¦æ—¶ï¼Œè¿ç®—ç¬¦ä¼˜å…ˆçº§å¯èƒ½å¯¼è‡´æŸ¥è¯¢é€»è¾‘é”™è¯¯

**ä¿®å¤æ–¹æ³•**ï¼š
- æ”¹è¿›å¼‚å¸¸å¤„ç†ï¼ŒæŠ›å‡ºå¼‚å¸¸è€Œä¸æ˜¯é™é»˜å¤±è´¥
- ä½¿ç”¨ `and_()` å’Œ `or_()` å‡½æ•°æ›¿ä»£ `&` å’Œ `|` è¿ç®—ç¬¦

#### 5. æ•°æ®åº“è¿ç§»ä¿®å¤ï¼ˆmessagesè¡¨ç¼ºå°‘message_typeåˆ—ï¼‰

**é—®é¢˜æè¿°**ï¼š
- æ•°æ®åº“è¡¨ `messages` ç¼ºå°‘ `message_type` å’Œ `broadcast_scope` åˆ—

**ä¿®å¤æ–¹æ³•**ï¼š
æ·»åŠ è‡ªåŠ¨æ•°æ®åº“è¿ç§»æ–¹æ³•ï¼Œåœ¨æ•°æ®åº“ç®¡ç†å™¨åˆå§‹åŒ–æ—¶æ£€æŸ¥å¹¶æ·»åŠ ç¼ºå¤±çš„åˆ—ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: 4.0  
**æœ€åæ›´æ–°**: 2025-02-20  
**ç»´æŠ¤è€…**: CorrectPath, A-Dawn, cuckoo711

## 2025-11-24 - ç”¨æˆ·åŠŸèƒ½å’Œç®¡ç†å‘˜åŠŸèƒ½å¢å¼º

### æ–°å¢åŠŸèƒ½

#### 1. åˆ·æ–°ä»¤ç‰Œæœºåˆ¶

**æ–°å¢æ¥å£**ï¼š
- `POST /api/refresh` - åˆ·æ–°è®¿é—®ä»¤ç‰Œ

**åŠŸèƒ½è¯´æ˜**ï¼š
- ç™»å½•æ¥å£ç°åœ¨è¿”å› `refresh_token` å’Œ `expires_in` å­—æ®µ
- æ”¯æŒä½¿ç”¨åˆ·æ–°ä»¤ç‰Œè·å–æ–°çš„è®¿é—®ä»¤ç‰Œï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- è®¿é—®ä»¤ç‰Œæœ‰æ•ˆæœŸ15åˆ†é’Ÿï¼Œåˆ·æ–°ä»¤ç‰Œæœ‰æ•ˆæœŸæ›´é•¿

**å®ç°ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`api_routes.py`
- è¡Œå·ï¼š`refresh_token`: ç¬¬121-180è¡Œ

#### 2. ç”¨æˆ·å¤´åƒåŠŸèƒ½

**æ–°å¢æ¥å£**ï¼š
- `POST /api/users/me/avatar` - ä¸Šä¼ å¤´åƒ
- `DELETE /api/users/me/avatar` - åˆ é™¤å¤´åƒ
- `GET /api/users/{user_id}/avatar` - è·å–ç”¨æˆ·å¤´åƒ

**åŠŸèƒ½è¯´æ˜**ï¼š
- æ”¯æŒä¸Šä¼ ã€åˆ é™¤å’Œè·å–ç”¨æˆ·å¤´åƒ
- æ”¯æŒ JPGã€JPEGã€PNGã€GIFã€WEBP æ ¼å¼
- è‡ªåŠ¨ç”Ÿæˆç¼©ç•¥å›¾
- å¦‚æœç”¨æˆ·æ²¡æœ‰ä¸Šä¼ å¤´åƒï¼Œè¿”å›è‡ªåŠ¨ç”Ÿæˆçš„å¤´åƒ
- å¤´åƒæœ€å¤§ 2MBï¼Œæœ€å¤§å°ºå¯¸ 1024x1024 åƒç´ 

**å®ç°ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`api_routes.py`
- è¡Œå·ï¼š
  - `upload_avatar`: ç¬¬493-566è¡Œ
  - `delete_avatar`: ç¬¬567-612è¡Œ
  - `get_user_avatar`: ç¬¬614-644è¡Œ
- æ–‡ä»¶ï¼š`avatar_utils.py` - å¤´åƒå¤„ç†å·¥å…·

#### 3. ä¿®æ”¹å¯†ç åŠŸèƒ½

**æ–°å¢æ¥å£**ï¼š
- `PUT /api/users/me/password` - ä¿®æ”¹å¯†ç 

**åŠŸèƒ½è¯´æ˜**ï¼š
- æ”¯æŒç”¨æˆ·ä¿®æ”¹è‡ªå·±çš„å¯†ç 
- éœ€è¦æä¾›å½“å‰å¯†ç è¿›è¡ŒéªŒè¯
- å¯†ç ä¿®æ”¹åï¼Œæ‰€æœ‰ç°æœ‰Tokenå°†å¤±æ•ˆï¼ˆé€šè¿‡password_versionæœºåˆ¶ï¼‰
- å¸¦é€Ÿç‡é™åˆ¶ï¼šæ¯åˆ†é’Ÿæœ€å¤š5æ¬¡å°è¯•

**å®ç°ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`api_routes.py`
- è¡Œå·ï¼š`change_password`: ç¬¬422-490è¡Œ

#### 4. ç®¡ç†å‘˜åŠŸèƒ½å¢å¼º

**æ–°å¢æ¥å£**ï¼š
- `GET /api/admin/broadcast-messages` - è·å–å¹¿æ’­æ¶ˆæ¯ç»Ÿè®¡
- `GET /api/admin/stats` - è·å–ç³»ç»Ÿç»Ÿè®¡æ•°æ®
- `GET /api/admin/recent-users` - è·å–æœ€è¿‘æ³¨å†Œç”¨æˆ·
- `GET /api/admin/users` - è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µå’Œæœç´¢ï¼‰
- `PUT /api/admin/users/{user_id}/role` - æ›´æ–°ç”¨æˆ·è§’è‰²
- `DELETE /api/admin/users/{user_id}` - åˆ é™¤ç”¨æˆ·
- `POST /api/admin/users` - åˆ›å»ºæ–°ç”¨æˆ·
- `GET /api/admin/knowledge/all` - è·å–æ‰€æœ‰çŸ¥è¯†åº“ï¼ˆç®¡ç†å‘˜ï¼‰
- `GET /api/admin/persona/all` - è·å–æ‰€æœ‰äººè®¾å¡ï¼ˆç®¡ç†å‘˜ï¼‰
- `POST /api/admin/knowledge/{kb_id}/revert` - æ¢å¤çŸ¥è¯†åº“å®¡æ ¸çŠ¶æ€
- `POST /api/admin/persona/{pc_id}/revert` - æ¢å¤äººè®¾å¡å®¡æ ¸çŠ¶æ€
- `GET /api/admin/upload-history` - è·å–ä¸Šä¼ å†å²è®°å½•
- `GET /api/admin/upload-stats` - è·å–ä¸Šä¼ ç»Ÿè®¡æ•°æ®
- `DELETE /api/admin/uploads/{upload_id}` - åˆ é™¤ä¸Šä¼ è®°å½•
- `POST /api/admin/uploads/{upload_id}/reprocess` - é‡æ–°å¤„ç†ä¸Šä¼ 

**åŠŸèƒ½è¯´æ˜**ï¼š
- æä¾›å®Œæ•´çš„ç®¡ç†å‘˜ç®¡ç†åŠŸèƒ½
- æ”¯æŒç”¨æˆ·ç®¡ç†ã€å†…å®¹ç®¡ç†ã€ä¸Šä¼ ç»Ÿè®¡ç­‰
- æ‰€æœ‰æ¥å£éœ€è¦adminæƒé™

**å®ç°ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`api_routes.py`
- è¡Œå·ï¼šç¬¬2838-4108è¡Œ

### æ¥å£å˜æ›´

#### ç™»å½•æ¥å£å“åº”æ ¼å¼æ›´æ–°

**å˜æ›´å‰**ï¼š
```json
{
  "access_token": "...",
  "token_type": "bearer"
}
```

**å˜æ›´å**ï¼š
```json
{
  "access_token": "...",
  "refresh_token": "...",
  "token_type": "bearer",
  "expires_in": 900,
  "user": {
    "id": "...",
    "username": "...",
    "email": "...",
    "role": "..."
  }
}
```

#### è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£å“åº”æ ¼å¼æ›´æ–°

**æ–°å¢å­—æ®µ**ï¼š
- `avatar_url`: å¤´åƒURL
- `avatar_updated_at`: å¤´åƒæ›´æ–°æ—¶é—´

### å½±å“èŒƒå›´

**æ–°å¢æ¥å£**ï¼ˆå®¢æˆ·ç«¯å¯é€‰é›†æˆï¼‰ï¼š
- `POST /api/refresh` - åˆ·æ–°è®¿é—®ä»¤ç‰Œ
- `PUT /api/users/me/password` - ä¿®æ”¹å¯†ç 
- `POST /api/users/me/avatar` - ä¸Šä¼ å¤´åƒ
- `DELETE /api/users/me/avatar` - åˆ é™¤å¤´åƒ
- `GET /api/users/{user_id}/avatar` - è·å–ç”¨æˆ·å¤´åƒ
- æ‰€æœ‰ç®¡ç†å‘˜æ¥å£ï¼ˆéœ€è¦adminæƒé™ï¼‰

**æ¥å£å˜æ›´**ï¼ˆå®¢æˆ·ç«¯éœ€è¦æ›´æ–°ï¼‰ï¼š
- `POST /api/token` - å“åº”æ ¼å¼å·²æ›´æ–°ï¼ŒåŒ…å«æ›´å¤šå­—æ®µ
- `GET /api/users/me` - å“åº”æ ¼å¼å·²æ›´æ–°ï¼ŒåŒ…å«å¤´åƒä¿¡æ¯

### ç›¸å…³æ–‡ä»¶

- `MaiMaiNotePad-BackEnd/api_routes.py` - APIè·¯ç”±å®ç°
- `MaiMaiNotePad-BackEnd/avatar_utils.py` - å¤´åƒå¤„ç†å·¥å…·
- `MaiMaiNotePad-BackEnd/database_models.py` - æ•°æ®åº“æ¨¡å‹ï¼ˆUseræ¨¡å‹å·²åŒ…å«å¤´åƒå­—æ®µï¼‰
- `MaiMaiNotePad-BackEnd/jwt_utils.py` - JWTå·¥å…·ï¼ˆåŒ…å«åˆ·æ–°ä»¤ç‰ŒåŠŸèƒ½ï¼‰

---

## 2025-11-22 - API Bugä¿®å¤å’Œä¼˜åŒ–

### ä¿®å¤å†…å®¹

ä¸»è¦è§£å†³äº†å¤šä¸ªAPIçš„é—®é¢˜å’Œä¼˜åŒ–ï¼š

#### 1. å®¡æ ¸APIä¿®å¤ï¼ˆçŸ¥è¯†åº“å’Œäººè®¾å¡å®¡æ‰¹å¤±è´¥ï¼‰

**é—®é¢˜æè¿°ï¼š**
- `approve_knowledge_base`ã€`reject_knowledge_base`ã€`approve_persona_card` å’Œ `reject_persona_card` å››ä¸ªå®¡æ ¸APIåœ¨è°ƒç”¨ `save_knowledge_base` å’Œ `save_persona_card` æ—¶ä¼ çš„æ˜¯å¯¹è±¡ï¼Œä½†è¿™ä¸¤ä¸ªæ–¹æ³•æœŸæœ›å­—å…¸å‚ã€‚

**ä¿®å¤ä½ç½®ï¼š**
- æ–‡ä»¶ï¼š`api_routes.py`
- è¡Œå·ï¼š
  - `approve_knowledge_base`: ç¬¬1656è¡Œ
  - `reject_knowledge_base`: ç¬¬1700è¡Œ
  - `approve_persona_card`: ç¬¬1753è¡Œ
  - `reject_persona_card`: ç¬¬1797è¡Œ

**ä¿®å¤æ–¹æ³•ï¼š**
åœ¨è°ƒç”¨ `save_knowledge_base` å’Œ `save_persona_card` ä¹‹å‰ï¼Œç”¨ `to_dict()` æŠŠå¯¹è±¡è½¬æˆå­—å…¸ã€‚

**ä¿®æ”¹å‰ï¼š**
```python
updated_kb = db_manager.save_knowledge_base(kb)
```

**ä¿®æ”¹åï¼š**
```python
updated_kb = db_manager.save_knowledge_base(kb.to_dict())
```

---

#### 1.1. å®¡æ ¸æ‹’ç»APIå‚æ•°ä¼ é€’æ–¹å¼ä¼˜åŒ–

**é—®é¢˜æè¿°ï¼š**
- `reject_knowledge_base` å’Œ `reject_persona_card` æ¥å£çš„ `reason` å‚æ•°åŸæœ¬ä½¿ç”¨æŸ¥è¯¢å‚æ•°ï¼ˆQueryï¼‰ï¼Œä¸ç¬¦åˆRESTfulæœ€ä½³å®è·µï¼Œä¸”å¯¹äºè¾ƒé•¿çš„æ‹’ç»åŸå› ä¸å¤Ÿå‹å¥½ã€‚

**ä¿®å¤ä½ç½®ï¼š**
- æ–‡ä»¶ï¼š`api_routes.py`
- è¡Œå·ï¼š
  - `reject_knowledge_base`: ç¬¬1694è¡Œ
  - `reject_persona_card`: ç¬¬1791è¡Œ

**ä¿®å¤æ–¹æ³•ï¼š**
å°† `reason` å‚æ•°ä»æŸ¥è¯¢å‚æ•°æ”¹ä¸ºè¯·æ±‚ä½“ï¼ˆBodyï¼‰ï¼Œä½¿ç”¨ `Body(..., embed=True)` æ¥æ”¶JSONæ ¼å¼çš„è¯·æ±‚ä½“ã€‚

**ä¿®æ”¹å‰ï¼š**
```python
@api_router.post("/review/knowledge/{kb_id}/reject")
async def reject_knowledge_base(
    kb_id: str,
    reason: str = Query(...),  # æŸ¥è¯¢å‚æ•°
    current_user: dict = Depends(get_current_user)
):
    # ...
```

**ä¿®æ”¹åï¼š**
```python
@api_router.post("/review/knowledge/{kb_id}/reject")
async def reject_knowledge_base(
    kb_id: str,
    reason: str = Body(..., embed=True),  # è¯·æ±‚ä½“
    current_user: dict = Depends(get_current_user)
):
    # ...
```

**APIè°ƒç”¨æ–¹å¼å˜æ›´ï¼š**

ä¿®æ”¹å‰ï¼ˆæŸ¥è¯¢å‚æ•°ï¼‰ï¼š
```bash
POST /api/review/knowledge/{kb_id}/reject?reason=æ‹’ç»åŸå› 
```

ä¿®æ”¹åï¼ˆè¯·æ±‚ä½“ï¼‰ï¼š
```bash
POST /api/review/knowledge/{kb_id}/reject
Content-Type: application/json

{
  "reason": "æ‹’ç»åŸå› "
}
```

**å½±å“ï¼š**
- å®¢æˆ·ç«¯éœ€è¦æ›´æ–°è°ƒç”¨æ–¹å¼ï¼Œå°† `reason` å‚æ•°ä»æŸ¥è¯¢å­—ç¬¦ä¸²æ”¹ä¸ºJSONè¯·æ±‚ä½“
- æ›´ç¬¦åˆRESTful APIè®¾è®¡è§„èŒƒ
- æ”¯æŒæ›´é•¿çš„æ‹’ç»åŸå› æ–‡æœ¬

---

#### 2. æ¶ˆæ¯å‘é€APIä¿®å¤ï¼ˆæ¶ˆæ¯åˆ›å»ºå¤±è´¥ï¼‰

**é—®é¢˜æè¿°ï¼š**
- `Message.to_dict()` æ–¹æ³•è¿”å›çš„ `created_at` å­—æ®µæ˜¯ ISO æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä½† `MessageResponse` Pydanticæ¨¡å‹æœŸæœ›æ¥æ”¶ `datetime` å¯¹è±¡ï¼ˆè¿™é‡Œçš„ISOæ ¼å¼å­—ç¬¦ä¸²æˆ‘çœŸçš„æ²¡æ‡‚å«ä¹‰ï¼Œè‹¥çœŸçš„è¦ç”¨çš„è¯æ­¤å¤„ä¿®å¤å¯æ¢ä¸ªå®ç°æ–¹å¼ï¼‰ã€‚

**ä¿®å¤ä½ç½®ï¼š**
- æ–‡ä»¶ï¼š`database_models.py`
- ç±»ï¼š`Message`
- æ–¹æ³•ï¼š`to_dict()`
- è¡Œå·ï¼šç¬¬338-351è¡Œ

**ä¿®å¤æ–¹æ³•ï¼š**
ä¿®æ”¹ `Message.to_dict()` æ–¹æ³•ï¼Œç¡®ä¿ `created_at` å­—æ®µè¿”å› `datetime` å¯¹è±¡è€Œä¸æ˜¯å­—ç¬¦ä¸²ã€‚

**ä¿®æ”¹å‰ï¼š**
```python
def to_dict(self):
    """å°†æ¶ˆæ¯å¯¹è±¡è½¬æ¢ä¸ºå­—å…¸"""
    data = {
        ...
        "created_at": self.created_at.isoformat() if self.created_at else datetime.now().isoformat()
    }
    return data
```

**ä¿®æ”¹åï¼š**
```python
def to_dict(self):
    """å°†æ¶ˆæ¯å¯¹è±¡è½¬æ¢ä¸ºå­—å…¸"""
    data = {
        ...
        "created_at": self.created_at if self.created_at else datetime.now()
    }
    return data
```

---

#### 3. æ¶ˆæ¯è·å–APIä¿®å¤ï¼ˆè·å–æ¶ˆæ¯åˆ—è¡¨å¤±è´¥ï¼‰

**é—®é¢˜æè¿°ï¼š**
- `api_routes.py` ä¸­å®šä¹‰äº†é‡å¤çš„ `MessageResponse` ç±»ï¼Œä¸ `models.py` ä¸­çš„å®šä¹‰ä¸ä¸€è‡´ï¼Œå¯¼è‡´ç±»å‹éªŒè¯å¤±è´¥ã€‚

**ä¿®å¤ä½ç½®ï¼š**
- æ–‡ä»¶ï¼š`api_routes.py`
- è¡Œå·ï¼šç¬¬14-16è¡Œï¼ˆå¯¼å…¥è¯­å¥ï¼‰ï¼Œç¬¬1934-1942è¡Œï¼ˆåˆ é™¤é‡å¤å®šä¹‰ï¼‰

**ä¿®å¤æ–¹æ³•ï¼š**
1. ä» `models.py` å¯¼å…¥ `MessageResponse`
2. åˆ é™¤ `api_routes.py` ä¸­é‡å¤çš„ `MessageResponse` ç±»å®šä¹‰

**ä¿®æ”¹å‰ï¼š**
```python
from models import (
    KnowledgeBase, PersonaCard, Message, MessageCreate, StarRecord,
    KnowledgeBaseUpdate
)

# ... åœ¨æ–‡ä»¶ä¸­æŸå¤„å®šä¹‰äº†é‡å¤çš„ MessageResponse
class MessageResponse(BaseModel):
    id: str
    sender_id: str
    recipient_id: str
    title: str
    content: str
    message_type: str
    broadcast_scope: Optional[str]
    is_read: bool
    created_at: str
```

**ä¿®æ”¹åï¼š**
```python
from models import (
    KnowledgeBase, PersonaCard, Message, MessageCreate, StarRecord,
    KnowledgeBaseUpdate, MessageResponse
)

# åˆ é™¤äº†é‡å¤çš„ MessageResponse å®šä¹‰
```

---

#### 4. æ¶ˆæ¯APIè¿›ä¸€æ­¥ä¿®å¤ï¼ˆæ‰¹é‡åˆ›å»ºå’ŒæŸ¥è¯¢ä¼˜åŒ–ï¼‰

**é—®é¢˜æè¿°ï¼š**
- `bulk_create_messages` æ–¹æ³•åœ¨å¼‚å¸¸æ—¶åªæ‰“å°é”™è¯¯å¹¶è¿”å›ç©ºåˆ—è¡¨ï¼Œå¯¼è‡´é”™è¯¯ä¿¡æ¯ä¸¢å¤±
- SQLæŸ¥è¯¢ä¸­ä½¿ç”¨ `&` å’Œ `|` è¿ç®—ç¬¦æ—¶ï¼Œè¿ç®—ç¬¦ä¼˜å…ˆçº§å¯èƒ½å¯¼è‡´æŸ¥è¯¢é€»è¾‘é”™è¯¯

**ä¿®å¤ä½ç½®ï¼š**
- æ–‡ä»¶ï¼š`database_models.py`
- æ–¹æ³•ï¼š
  - `bulk_create_messages`: ç¬¬681-697è¡Œ
  - `get_conversation_messages`: ç¬¬699-707è¡Œ
  - `get_user_messages`: ç¬¬709-714è¡Œ
- æ–‡ä»¶ï¼š`api_routes.py`
- æ–¹æ³•ï¼š`send_message`: ç¬¬1886-1888è¡Œ

**ä¿®å¤æ–¹æ³•ï¼š**

1. **æ”¹è¿›å¼‚å¸¸å¤„ç†ï¼š** `bulk_create_messages` ç°åœ¨ä¼šæŠ›å‡ºå¼‚å¸¸è€Œä¸æ˜¯é™é»˜å¤±è´¥
2. **ä¿®å¤SQLæŸ¥è¯¢ï¼š** ä½¿ç”¨ `and_()` å’Œ `or_()` å‡½æ•°æ›¿ä»£ `&` å’Œ `|` è¿ç®—ç¬¦ï¼Œç¡®ä¿æŸ¥è¯¢é€»è¾‘æ­£ç¡®
3. **æ”¹è¿›é”™è¯¯ä¼ æ’­ï¼š** APIè·¯ç”±ä¸­æ•è·å¹¶è½¬æ¢å¼‚å¸¸ä¸º `DatabaseError`

**ä¿®æ”¹å‰ï¼š**
```python
def bulk_create_messages(self, messages: List[dict]) -> List[Message]:
    try:
        # ... åˆ›å»ºæ¶ˆæ¯
        return message_models
    except Exception as e:
        print(f"æ‰¹é‡åˆ›å»ºæ¶ˆæ¯å¤±è´¥: {str(e)}")
        return []  # é™é»˜å¤±è´¥

def get_conversation_messages(self, user_id: str, other_user_id: str, ...):
    return session.query(Message).filter(
        (Message.sender_id == user_id) & (Message.recipient_id == other_user_id) |
        (Message.sender_id == other_user_id) & (Message.recipient_id == user_id)
    ).all()  # è¿ç®—ç¬¦ä¼˜å…ˆçº§å¯èƒ½å¯¼è‡´é€»è¾‘é”™è¯¯
```

**ä¿®æ”¹åï¼š**
```python
def bulk_create_messages(self, messages: List[dict]) -> List[Message]:
    session = None
    try:
        with self.get_session() as session:
            # ... åˆ›å»ºæ¶ˆæ¯
            return message_models
    except Exception as e:
        if session:
            try:
                session.rollback()
            except:
                pass
        raise Exception(f"æ‰¹é‡åˆ›å»ºæ¶ˆæ¯å¤±è´¥: {str(e)}")  # æŠ›å‡ºå¼‚å¸¸

def get_conversation_messages(self, user_id: str, other_user_id: str, ...):
    return session.query(Message).filter(
        or_(
            and_(Message.sender_id == user_id, Message.recipient_id == other_user_id),
            and_(Message.sender_id == other_user_id, Message.recipient_id == user_id)
        )
    ).all()  # ä½¿ç”¨æ˜ç¡®çš„é€»è¾‘å‡½æ•°
```

---

#### 5. æ•°æ®åº“è¿ç§»ä¿®å¤ï¼ˆmessagesè¡¨ç¼ºå°‘message_typeåˆ—ï¼‰

**é—®é¢˜æè¿°ï¼š**
- æ•°æ®åº“è¡¨ `messages` ç¼ºå°‘ `message_type` å’Œ `broadcast_scope` åˆ—ï¼Œå¯¼è‡´æ¶ˆæ¯åˆ›å»ºå’ŒæŸ¥è¯¢å¤±è´¥
- é”™è¯¯ä¿¡æ¯ï¼š`table messages has no column named message_type`

**ä¿®å¤ä½ç½®ï¼š**
- æ–‡ä»¶ï¼š`database_models.py`
- ç±»ï¼š`SQLiteDatabaseManager`
- æ–¹æ³•ï¼š`__init__` å’Œæ–°å¢çš„ `_migrate_database`
- è¡Œå·ï¼šç¬¬437-463è¡Œ

**ä¿®å¤æ–¹æ³•ï¼š**
æ·»åŠ è‡ªåŠ¨æ•°æ®åº“è¿ç§»æ–¹æ³•ï¼Œåœ¨æ•°æ®åº“ç®¡ç†å™¨åˆå§‹åŒ–æ—¶æ£€æŸ¥å¹¶æ·»åŠ ç¼ºå¤±çš„åˆ—ã€‚

**ä¿®æ”¹å‰ï¼š**
```python
def __init__(self, db_path: str = "./data/maimnp.db"):
    # ...
    # åˆ›å»ºæ‰€æœ‰è¡¨
    Base.metadata.create_all(bind=self.engine)
    # æ²¡æœ‰è¿ç§»é€»è¾‘ï¼Œå¦‚æœè¡¨å·²å­˜åœ¨ä½†ç¼ºå°‘åˆ—ï¼Œä¼šå¯¼è‡´é”™è¯¯
```

**ä¿®æ”¹åï¼š**
```python
def __init__(self, db_path: str = "./data/maimnp.db"):
    # ...
    # åˆ›å»ºæ‰€æœ‰è¡¨
    Base.metadata.create_all(bind=self.engine)
    
    # æ‰§è¡Œæ•°æ®åº“è¿ç§»
    self._migrate_database()

def _migrate_database(self):
    """æ‰§è¡Œæ•°æ®åº“è¿ç§»ï¼Œæ·»åŠ ç¼ºå¤±çš„åˆ—"""
    try:
        inspector = inspect(self.engine)
        if 'messages' in inspector.get_table_names():
            existing_columns = [col['name'] for col in inspector.get_columns('messages')]
            
            if 'message_type' not in existing_columns:
                with self.engine.begin() as conn:
                    conn.execute(text("ALTER TABLE messages ADD COLUMN message_type VARCHAR DEFAULT 'direct'"))
                print("å·²æ·»åŠ  message_type åˆ—åˆ° messages è¡¨")
            
            if 'broadcast_scope' not in existing_columns:
                with self.engine.begin() as conn:
                    conn.execute(text("ALTER TABLE messages ADD COLUMN broadcast_scope VARCHAR"))
                print("å·²æ·»åŠ  broadcast_scope åˆ—åˆ° messages è¡¨")
    except Exception as e:
        print(f"æ•°æ®åº“è¿ç§»å¤±è´¥: {str(e)}")
```

**æ³¨æ„äº‹é¡¹ï¼š**
- è¿ç§»ä¼šåœ¨åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ
- å¦‚æœè¡¨å·²å­˜åœ¨ä½†ç¼ºå°‘åˆ—ï¼Œè¿ç§»ä¼šè‡ªåŠ¨æ·»åŠ 
- è¿ç§»å¤±è´¥ä¸ä¼šé˜»æ­¢åº”ç”¨å¯åŠ¨ï¼Œä½†ä¼šæ‰“å°é”™è¯¯ä¿¡æ¯

---

### å½±å“èŒƒå›´

- **APIç«¯ç‚¹ï¼š**
  - `POST /review/knowledge/{kb_id}/approve` - å®¡æ ¸é€šè¿‡çŸ¥è¯†åº“
  - `POST /review/knowledge/{kb_id}/reject` - å®¡æ ¸æ‹’ç»çŸ¥è¯†åº“ï¼ˆ**å‚æ•°ä¼ é€’æ–¹å¼å˜æ›´ï¼šä»æŸ¥è¯¢å‚æ•°æ”¹ä¸ºè¯·æ±‚ä½“**ï¼‰
  - `POST /review/persona/{pc_id}/approve` - å®¡æ ¸é€šè¿‡äººè®¾å¡
  - `POST /review/persona/{pc_id}/reject` - å®¡æ ¸æ‹’ç»äººè®¾å¡ï¼ˆ**å‚æ•°ä¼ é€’æ–¹å¼å˜æ›´ï¼šä»æŸ¥è¯¢å‚æ•°æ”¹ä¸ºè¯·æ±‚ä½“**ï¼‰
  - `POST /api/messages/send` - å‘é€æ¶ˆæ¯ï¼ˆç§ä¿¡å’Œå…¬å‘Šï¼‰
  - `GET /api/messages` - è·å–æ¶ˆæ¯åˆ—è¡¨
  - `GET /api/messages?other_user_id={id}` - è·å–ä¸ç‰¹å®šç”¨æˆ·çš„å¯¹è¯

- **æ•°æ®æ¨¡å‹ï¼š**
  - `Message.to_dict()` æ–¹æ³•çš„è¿”å›å€¼æ ¼å¼

- **APIè°ƒç”¨æ–¹å¼å˜æ›´ï¼š**
  - `POST /api/review/knowledge/{kb_id}/reject` å’Œ `POST /api/review/persona/{pc_id}/reject` æ¥å£çš„è°ƒç”¨æ–¹å¼éœ€è¦æ›´æ–°
  - å®¢æˆ·ç«¯éœ€è¦å°† `reason` å‚æ•°ä»æŸ¥è¯¢å­—ç¬¦ä¸²æ”¹ä¸ºJSONè¯·æ±‚ä½“

---

### å˜æ›´æ€»è§ˆ

**ä»£ç é€»è¾‘å±‚é¢çš„ä¿®å¤ï¼š**
1. æ•°æ®ç±»å‹è½¬æ¢ï¼ˆå¯¹è±¡è½¬å­—å…¸ï¼‰
2. è¿”å›æ ¼å¼è°ƒæ•´ï¼ˆå­—ç¬¦ä¸²è½¬datetimeå¯¹è±¡ï¼‰
3. ä»£ç é‡æ„ï¼ˆåˆ é™¤é‡å¤å®šä¹‰ï¼Œç»Ÿä¸€ç”¨models.pyä¸­çš„å®šä¹‰ï¼‰
4. å¼‚å¸¸å¤„ç†æ”¹è¿›ï¼ˆæŠ›å‡ºå¼‚å¸¸è€Œä¸æ˜¯é™é»˜å¤±è´¥ï¼‰
5. SQLæŸ¥è¯¢ä¼˜åŒ–ï¼ˆä½¿ç”¨æ˜ç¡®çš„é€»è¾‘å‡½æ•°ç¡®ä¿æŸ¥è¯¢æ­£ç¡®ï¼‰

**APIæ¥å£ä¼˜åŒ–ï¼š**
6. å®¡æ ¸æ‹’ç»æ¥å£å‚æ•°ä¼ é€’æ–¹å¼ä¼˜åŒ–ï¼ˆä»æŸ¥è¯¢å‚æ•°æ”¹ä¸ºè¯·æ±‚ä½“ï¼Œæ›´ç¬¦åˆRESTfulè§„èŒƒï¼‰

**æ•°æ®åº“ç»“æ„ä¿®å¤ï¼š**
7. è‡ªåŠ¨æ•°æ®åº“è¿ç§»ï¼ˆæ·»åŠ ç¼ºå¤±çš„ `message_type` å’Œ `broadcast_scope` åˆ—ï¼‰

**æ•°æ®åº“è¿ç§»è¯´æ˜ï¼š**
- è¿ç§»ä¼šåœ¨åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ
- å¦‚æœ `messages` è¡¨å·²å­˜åœ¨ä½†ç¼ºå°‘åˆ—ï¼Œè¿ç§»ä¼šè‡ªåŠ¨æ·»åŠ 
- ä¸éœ€è¦æ‰‹åŠ¨æ‰§è¡ŒSQLè„šæœ¬ï¼Œé‡å¯åº”ç”¨å³å¯

---

### ç›¸å…³æ–‡ä»¶

- `MaiMaiNotePad-BackEnd/api_routes.py` - APIè·¯ç”±å®ç°
- `MaiMaiNotePad-BackEnd/database_models.py` - æ•°æ®åº“æ¨¡å‹å®šä¹‰
- `MaiMaiNotePad-BackEnd/models.py` - Pydanticæ¨¡å‹å®šä¹‰

---

## 2025-11-23 - æ–°å¢åŠŸèƒ½å’Œæ¥å£ä¼˜åŒ–

### æ–°å¢åŠŸèƒ½

#### 1. StarçŠ¶æ€æ£€æŸ¥æ¥å£

**æ–°å¢æ¥å£**ï¼š
- `GET /api/knowledge/{kb_id}/starred` - æ£€æŸ¥çŸ¥è¯†åº“æ˜¯å¦å·²è¢«å½“å‰ç”¨æˆ·Star
- `GET /api/persona/{pc_id}/starred` - æ£€æŸ¥äººè®¾å¡æ˜¯å¦å·²è¢«å½“å‰ç”¨æˆ·Star

**åŠŸèƒ½è¯´æ˜**ï¼š
- è¿”å›æ ¼å¼ï¼š`{"starred": true/false}`
- éœ€è¦ç”¨æˆ·è®¤è¯
- ç”¨äºå‰ç«¯å¿«é€Ÿæ£€æŸ¥StarçŠ¶æ€ï¼Œé¿å…è·å–æ‰€æœ‰Starè®°å½•

**å®ç°ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`api_routes.py`
- è¡Œå·ï¼š
  - `check_knowledge_starred`: ç¬¬861-874è¡Œ
  - `check_persona_starred`: ç¬¬1508-1521è¡Œ

#### 2. åˆ†é¡µæ”¯æŒ

**æ–°å¢åˆ†é¡µæ¥å£**ï¼š
- `GET /api/knowledge/public` - æ”¯æŒåˆ†é¡µã€æœç´¢ã€ç­›é€‰å’Œæ’åº
- `GET /api/persona/public` - æ”¯æŒåˆ†é¡µã€æœç´¢ã€ç­›é€‰å’Œæ’åº

**æŸ¥è¯¢å‚æ•°**ï¼š
- `page`: é¡µç ï¼ˆä»1å¼€å§‹ï¼‰
- `page_size`: æ¯é¡µæ•°é‡ï¼ˆ1-100ï¼‰
- `name`: æŒ‰åç§°æœç´¢ï¼ˆå¯é€‰ï¼‰
- `uploader_id`: æŒ‰ä¸Šä¼ è€…IDç­›é€‰ï¼ˆå¯é€‰ï¼‰
- `sort_by`: æ’åºå­—æ®µï¼ˆcreated_at, updated_at, star_countï¼‰
- `sort_order`: æ’åºé¡ºåºï¼ˆasc, descï¼‰

**å“åº”æ ¼å¼**ï¼š
```json
{
  "items": [...],
  "total": 100,
  "page": 1,
  "page_size": 20
}
```

#### 3. ç”¨æˆ·Starè®°å½•æ¥å£å¢å¼º

**æ¥å£**ï¼š`GET /api/user/stars`

**æ–°å¢å‚æ•°**ï¼š
- `includeDetails`: æ˜¯å¦åŒ…å«å®Œæ•´è¯¦æƒ…ï¼ˆå¯é€‰ï¼Œé»˜è®¤falseï¼‰

**åŠŸèƒ½è¯´æ˜**ï¼š
- å½“ `includeDetails=true` æ—¶ï¼Œè¿”å›Starè®°å½•çš„åŒæ—¶åŒ…å«çŸ¥è¯†åº“/äººè®¾å¡çš„å®Œæ•´ä¿¡æ¯
- å‡å°‘å‰ç«¯APIè°ƒç”¨æ¬¡æ•°ï¼Œä» 1+N æ¬¡è¯·æ±‚ä¼˜åŒ–åˆ° 1 æ¬¡è¯·æ±‚

**å®ç°ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`api_routes.py`
- è¡Œå·ï¼š`get_user_stars`: ç¬¬2026-2075è¡Œ

### å½±å“èŒƒå›´

**æ–°å¢æ¥å£**ï¼ˆå®¢æˆ·ç«¯å¯é€‰é›†æˆï¼‰ï¼š
- `GET /api/knowledge/{kb_id}/starred` - StarçŠ¶æ€æ£€æŸ¥
- `GET /api/persona/{pc_id}/starred` - StarçŠ¶æ€æ£€æŸ¥
- `GET /api/knowledge/public` - æ”¯æŒåˆ†é¡µå‚æ•°
- `GET /api/persona/public` - æ”¯æŒåˆ†é¡µå‚æ•°
- `GET /api/user/stars` - æ”¯æŒ `includeDetails` å‚æ•°

### ç›¸å…³æ–‡ä»¶

- `MaiMaiNotePad-BackEnd/api_routes.py` - APIè·¯ç”±å®ç°

## 2025-11-25 - å†…å®¹å­—æ®µå…¥åº“ä¸åˆ—è¡¨èƒ½åŠ›å¢å¼º

### åŠŸèƒ½ / æ¥å£
- çŸ¥è¯†åº“ä¸äººè®¾å¡ä¸Šä¼ æ–°å¢æ­£æ–‡ `content`ã€æ ‡ç­¾ `tags`ï¼Œå“åº”å¸¦ä½œè€…ä¿¡æ¯ã€æ–‡ä»¶åˆ—è¡¨ä¸å¤§å°èšåˆï¼Œåˆ é™¤æœ€åä¸€ä¸ªæ–‡ä»¶æ—¶è‡ªåŠ¨åˆ é™¤æ•´æ¡çŸ¥è¯†åº“ï¼ˆè¿”å› `knowledge_deleted` æ ‡è¯†ï¼‰
- ç”¨æˆ·ä¸Šä¼ è®°å½•ï¼ˆçŸ¥è¯†åº“ã€äººè®¾å¡ï¼‰æ”¯æŒåˆ†é¡µã€åç§°/æ ‡ç­¾/çŠ¶æ€ç­›é€‰ä¸å¤šå­—æ®µæ’åºï¼Œç®¡ç†å‘˜/å®¡æ ¸å‘˜å¯æŸ¥çœ‹ä»–äººè®°å½•
- ç”¨æˆ·æ”¶è—åˆ—è¡¨åˆ†é¡µåŒ–ï¼Œæ”¯æŒç±»å‹è¿‡æ»¤å’Œåˆ›å»ºæ—¶é—´/æ”¶è—æ•°æ’åºï¼Œè¿”å› `items/total/page/page_size` ç»“æ„
- ç®¡ç†ç«¯å†…å®¹åˆ—è¡¨æ–°å¢ä¸Šä¼ è€…ï¼ˆID/ç”¨æˆ·åæ¨¡ç³Šï¼‰ç­›é€‰ä¸æ’åºå­—æ®µ/æ–¹å‘å‚æ•°ï¼Œæ—¥å¿—è¾“å‡ºè¡¥å……ä¸Šä¸‹æ–‡
- ä¸Šä¼ /ä¸‹è½½ç›¸å…³ CORS æš´éœ² `Content-Disposition` å¤´ï¼Œå‰ç«¯å¯è¯»å–æ–‡ä»¶å

### æ¨¡å‹ / å­˜å‚¨
- `KnowledgeBase`ã€`PersonaCard` æ¨¡å‹æ–°å¢ `content`ã€`tags` å­—æ®µï¼›è¿”å›çš„ä½œè€…å­—æ®µå›è½åˆ°ç‰ˆæƒäºº/ä¸Šä¼ è€…
- SQLite è¿ç§»è¡¥å…… `content`ã€`tags` åˆ—å¹¶åœ¨ä¿å­˜å‰ç»Ÿä¸€å°†æ ‡ç­¾åˆ—è¡¨è½¬é€—å·å­—ç¬¦ä¸²

### æ–‡æ¡£
- API æ–‡æ¡£è¡¥å…… content/tags ä¼ å‚ã€ç”¨æˆ·ä¸Šä¼ /æ”¶è—åˆ†é¡µå‚æ•°ä¸å“åº”ã€åˆ é™¤æ–‡ä»¶è¿”å›å­—æ®µã€ç®¡ç†ç«¯ç­›é€‰ä¸æ’åºå‚æ•°ç¤ºä¾‹
- README/TODO åŒæ­¥ä¸Šè¿°è¡Œä¸ºä¸å®ŒæˆçŠ¶æ€

---

## 2025-12-01 - ç”¨æˆ·ä¸Šä¼ å†å²å’Œç»Ÿè®¡æ¥å£å¢å¼º

### æ–°å¢åŠŸèƒ½

#### 1. ç”¨æˆ·ä¸ªäººä¸Šä¼ å†å²æ¥å£

**æ–°å¢æ¥å£**ï¼š
- `GET /api/me/upload-history` - è·å–å½“å‰ç”¨æˆ·ä¸ªäººä¸Šä¼ å†å²è®°å½•

**åŠŸèƒ½è¯´æ˜**ï¼š
- æ”¯æŒåˆ†é¡µæŸ¥è¯¢ç”¨æˆ·ä¸Šä¼ è®°å½•
- è¿”å›çŸ¥è¯†åº“å’Œäººè®¾å¡çš„ä¸Šä¼ è®°å½•
- åŒ…å«çŠ¶æ€æ˜ å°„ï¼ˆapprovedâ†’successï¼Œpendingâ†’processingï¼Œrejectedâ†’failedï¼‰
- æä¾›ç›®æ ‡å­˜åœ¨æ€§æ£€æŸ¥å’Œæ–‡ä»¶å¤§å°ç»Ÿè®¡
- æ”¯æŒå…¼å®¹å‰ç«¯çš„å“åº”æ ¼å¼æ„å»º

**å®ç°ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`user_router.py`
- è¡Œå·ï¼šç¬¬1260-1320è¡Œ

#### 2. ç”¨æˆ·ä¸ªäººä¸Šä¼ ç»Ÿè®¡æ¥å£

**æ–°å¢æ¥å£**ï¼š
- `GET /api/me/upload-stats` - è·å–å½“å‰ç”¨æˆ·ä¸ªäººä¸Šä¼ ç»Ÿè®¡

**åŠŸèƒ½è¯´æ˜**ï¼š
- è·å–ç”¨æˆ·ä¸Šä¼ æ€»æ•°ã€æˆåŠŸæ•°ã€å¤„ç†ä¸­æ•°ã€å¤±è´¥æ•°
- è¿”å›åç«¯æ•°æ®åº“å­—æ®µåå’Œå‰ç«¯æœŸæœ›å­—æ®µåä¸¤ç§æ ¼å¼çš„ç»Ÿè®¡ç»“æœ
- æä¾›æˆåŠŸç‡å’Œæ–‡ä»¶å¤§å°ç»Ÿè®¡
- å…¼å®¹å‰ç«¯UIå±•ç¤ºéœ€æ±‚

**å®ç°ä½ç½®**ï¼š
- æ–‡ä»¶ï¼š`user_router.py`
- è¡Œå·ï¼šç¬¬1321-1380è¡Œ

### å½±å“èŒƒå›´

**æ–°å¢æ¥å£**ï¼ˆå®¢æˆ·ç«¯å¯é€‰é›†æˆï¼‰ï¼š
- `GET /api/me/upload-history` - ç”¨æˆ·ä¸ªäººä¸Šä¼ å†å²è®°å½•
- `GET /api/me/upload-stats` - ç”¨æˆ·ä¸ªäººä¸Šä¼ ç»Ÿè®¡

**åŠŸèƒ½å½±å“**ï¼š
- ç”¨æˆ·ç°åœ¨å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„ä¸Šä¼ å†å²å’Œç»Ÿè®¡æ•°æ®
- ä¸ç°æœ‰çš„ç®¡ç†å‘˜ä¸Šä¼ å†å²å’Œç»Ÿè®¡æ¥å£å½¢æˆäº’è¡¥
- æä¾›ä¸ªäººç»´åº¦çš„ä¸Šä¼ ç®¡ç†èƒ½åŠ›

### ç›¸å…³æ–‡ä»¶

- `user_router.py` - ç”¨æˆ·è·¯ç”±å®ç°
- `database_models.py` - æ•°æ®åº“æ¨¡å‹ï¼ˆUploadRecordè¡¨ï¼‰

---

## 2025-11-23 - ä»£ç è´¨é‡æ”¹è¿›

### ä»£ç è´¨é‡ä¿®å¤

#### 1. é‡å¤å®šä¹‰é—®é¢˜ä¿®å¤ âœ…

**é—®é¢˜æè¿°ï¼š**
- `api_routes.py` å’Œ `models.py` ä¸­é‡å¤å®šä¹‰äº†ç›¸åŒçš„å“åº”æ¨¡å‹ç±»
- å¯¼è‡´ç»´æŠ¤å›°éš¾ï¼Œå¯èƒ½å‡ºç°ä¸ä¸€è‡´é—®é¢˜

**ä¿®å¤ä½ç½®ï¼š**
- æ–‡ä»¶ï¼š`api_routes.py`
- è¡Œå·ï¼šç¬¬15-19è¡Œï¼ˆå¯¼å…¥è¯­å¥ï¼‰

**ä¿®å¤æ–¹æ³•ï¼š**
ç»Ÿä¸€ä» `models.py` å¯¼å…¥å“åº”æ¨¡å‹ï¼Œåˆ é™¤ `api_routes.py` ä¸­çš„é‡å¤å®šä¹‰ã€‚

**ä¿®æ”¹åï¼š**
```python
# api_routes.py ç¬¬15-19è¡Œ
from models import (
    KnowledgeBase, PersonaCard, Message, MessageCreate, MessageUpdate, StarRecord,
    KnowledgeBaseUpdate, MessageResponse, KnowledgeBaseResponse, PersonaCardResponse,
    StarResponse, KnowledgeBasePaginatedResponse, PersonaCardPaginatedResponse
)
```

**å½±å“ï¼š**
- ä»£ç ç¬¦åˆDRYåŸåˆ™
- å‡å°‘ç»´æŠ¤æˆæœ¬
- é¿å…å®šä¹‰ä¸ä¸€è‡´é—®é¢˜

#### 2. æ•°æ®åº“ç®¡ç†å™¨å®ä¾‹åŒ–ä¿®å¤ âœ…

**é—®é¢˜æè¿°ï¼š**
- æ•°æ®åº“ç®¡ç†å™¨å®ä¾‹åŒ–é—®é¢˜å¯èƒ½å¯¼è‡´å¾ªç¯å¯¼å…¥
- å…¶ä»–æ¨¡å—æ— æ³•æ­£å¸¸å¯¼å…¥å’Œä½¿ç”¨æ•°æ®åº“ç®¡ç†å™¨

**ä¿®å¤ä½ç½®ï¼š**
- æ–‡ä»¶ï¼š`database_models.py`
- è¡Œå·ï¼šç¬¬1809è¡Œ

**ä¿®å¤æ–¹æ³•ï¼š**
åˆ›å»ºå…¨å±€å®ä¾‹ `sqlite_db_manager`ï¼Œç¡®ä¿å…¶ä»–æ¨¡å—å¯ä»¥æ­£å¸¸å¯¼å…¥å’Œä½¿ç”¨ã€‚

**å½±å“ï¼š**
- è§£å†³å¾ªç¯å¯¼å…¥é—®é¢˜
- ç»Ÿä¸€æ•°æ®åº“ç®¡ç†å™¨å®ä¾‹
- æå‡ä»£ç å¯ç»´æŠ¤æ€§

### ç›¸å…³æ–‡ä»¶

- `MaiMaiNotePad-BackEnd/api_routes.py` - APIè·¯ç”±å®ç°
- `MaiMaiNotePad-BackEnd/database_models.py` - æ•°æ®åº“æ¨¡å‹å®šä¹‰
- `MaiMaiNotePad-BackEnd/models.py` - Pydanticæ¨¡å‹å®šä¹‰


---

## ğŸ“š ç‰ˆæœ¬å†å²è¯¦æƒ…

### v2.0.1 (2026-02-22) - æ–‡ä»¶ç»“æ„ä¼˜åŒ–ä¸ç‰ˆæœ¬ç®¡ç†å®Œå–„

**ç‰ˆæœ¬ç±»å‹**: ä¼˜åŒ–ç‰ˆæœ¬ï¼ˆPatchï¼‰

**ä¸»è¦å˜æ›´**:

#### 1. æ–‡ä»¶ç»“æ„ä¼˜åŒ– ğŸ“
- **ç§»åŠ¨æ ¸å¿ƒæ¨¡å—**: `app/error_handlers.py` â†’ `app/core/error_handlers.py`
  - é”™è¯¯å¤„ç†ä¸­é—´ä»¶
  - è‡ªå®šä¹‰å¼‚å¸¸ç±»
  - é”™è¯¯æ¶ˆæ¯è§£æ
  
- **ç§»åŠ¨ä¸šåŠ¡æœåŠ¡**: `app/file_upload.py` â†’ `app/services/file_upload_service.py`
  - FileUploadService ç±»
  - çŸ¥è¯†åº“æ–‡ä»¶ä¸Šä¼ 
  - äººè®¾å¡æ–‡ä»¶ä¸Šä¼ 

- **æµ‹è¯•æ–‡ä»¶é‡ç»„**: 4ä¸ªæµ‹è¯•æ–‡ä»¶ç§»åŠ¨åˆ°æ­£ç¡®ä½ç½®
  - ä¸¥æ ¼é•œåƒ app/ ç›®å½•ç»“æ„
  - æå‡æµ‹è¯•å¯ç»´æŠ¤æ€§

#### 2. ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿå®Œå–„ âœ¨
- **åŠ¨æ€ç‰ˆæœ¬å·é…ç½®**: pyproject.toml è‡ªåŠ¨ä» app/__version__.py è¯»å–
- **å•ä¸€æ¥æºåŸåˆ™**: åªéœ€ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶å³å¯æ›´æ–°ç‰ˆæœ¬å·
- **ç‰ˆæœ¬æ£€æŸ¥å·¥å…·**: æ–°å¢ scripts/python/check_version.py
- **é…ç½®æ¸…ç†**: ç§»é™¤ config.toml ä¸­çš„å†—ä½™ç‰ˆæœ¬å·é…ç½®

#### 3. å¯¼å…¥å¼•ç”¨æ›´æ–°
- æ›´æ–° 14 ä¸ªæºä»£ç æ–‡ä»¶çš„å¯¼å…¥è¯­å¥
- ä¿®å¤æ‰€æœ‰æµ‹è¯•æ–‡ä»¶çš„ mock è·¯å¾„
- ä¿®å¤é…ç½®æ–‡ä»¶è·¯å¾„å¼•ç”¨

#### 4. æµ‹è¯•éªŒè¯
- âœ… 2227 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡
- âœ… æ‰€æœ‰å¯¼å…¥å¼•ç”¨æ­£ç¡®
- âœ… Mock è·¯å¾„å…¨éƒ¨ä¿®å¤

**å½±å“èŒƒå›´**:
- æºä»£ç : 2 ä¸ªæ–‡ä»¶ç§»åŠ¨ï¼Œ14 ä¸ªæ–‡ä»¶å¯¼å…¥æ›´æ–°
- æµ‹è¯•ä»£ç : 4 ä¸ªæ–‡ä»¶ç§»åŠ¨ï¼Œå¤šä¸ªæ–‡ä»¶è·¯å¾„æ›´æ–°
- é…ç½®æ–‡ä»¶: 3 ä¸ªæ–‡ä»¶æ›´æ–°
- æ–‡æ¡£: 5 ä¸ªæ–‡ä»¶æ›´æ–°

**å‡çº§è¯´æ˜**:
- æ— éœ€ç‰¹æ®Šæ“ä½œï¼Œæ‰€æœ‰å¯¼å…¥å·²è‡ªåŠ¨æ›´æ–°
- å»ºè®®è¿è¡Œ `python scripts/python/check_version.py` éªŒè¯ç‰ˆæœ¬é…ç½®

---

### v2.0.0 (2026-02-22) - é¡¹ç›®é‡æ„å®Œæˆ

**ç‰ˆæœ¬ç±»å‹**: é‡å¤§ç‰ˆæœ¬ï¼ˆMajorï¼‰

**ä¸»è¦å˜æ›´**:

#### 1. é¡¹ç›®ç»“æ„é‡æ„
- å®Œæˆæ•´ä½“é¡¹ç›®ç»“æ„ä¼˜åŒ–
- å»ºç«‹æ¸…æ™°çš„åˆ†å±‚æ¶æ„
- ç»Ÿä¸€ä»£ç ç»„ç»‡è§„èŒƒ

#### 2. æµ‹è¯•ä½“ç³»å®Œå–„
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡è¾¾åˆ° 91%
- é›†æˆæµ‹è¯•å…¨é¢è¦†ç›–
- å±æ€§æµ‹è¯•å¼•å…¥ Hypothesis

#### 3. æ–‡æ¡£ä½“ç³»å»ºç«‹
- API æ–‡æ¡£å®Œå–„
- æ¶æ„æ–‡æ¡£ç¼–å†™
- æµ‹è¯•æ–‡æ¡£å®Œæ•´
- é…ç½®ç®¡ç†æ–‡æ¡£

#### 4. å¼€å‘å·¥å…·å®Œå–„
- è„šæœ¬å·¥å…·é›†
- æµ‹è¯•è¾…åŠ©å·¥å…·
- æ•°æ®åº“è¿ç§»å·¥å…·

**å½±å“èŒƒå›´**: å…¨é¡¹ç›®

**å‡çº§è¯´æ˜**: 
- è¿™æ˜¯é‡æ„åçš„ç¬¬ä¸€ä¸ªç¨³å®šç‰ˆæœ¬
- å»ºè®®å…¨é¢æµ‹è¯•åå†éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

### v1.0.0 (2026-02-20) - åˆå§‹ç‰ˆæœ¬å‘å¸ƒ

**ç‰ˆæœ¬ç±»å‹**: åˆå§‹ç‰ˆæœ¬ï¼ˆInitial Releaseï¼‰

**ä¸»è¦åŠŸèƒ½**:

#### 1. æ ¸å¿ƒåŠŸèƒ½
- ç”¨æˆ·è®¤è¯ä¸æˆæƒ
- çŸ¥è¯†åº“ç®¡ç†
- äººè®¾å¡ç®¡ç†
- è¯„è®ºç³»ç»Ÿ
- æ¶ˆæ¯ç³»ç»Ÿ

#### 2. API æ¥å£
- RESTful API è®¾è®¡
- WebSocket å®æ—¶é€šä¿¡
- æ–‡ä»¶ä¸Šä¼ ä¸‹è½½
- æ•°æ®åˆ†é¡µæŸ¥è¯¢

#### 3. æ•°æ®åº“
- SQLite æ•°æ®åº“
- Alembic è¿ç§»æ”¯æŒ
- æ•°æ®æ¨¡å‹å®šä¹‰

#### 4. å®‰å…¨ç‰¹æ€§
- JWT è®¤è¯
- å¯†ç å“ˆå¸Œ
- æƒé™æ§åˆ¶
- è¾“å…¥éªŒè¯

**æŠ€æœ¯æ ˆ**:
- FastAPI æ¡†æ¶
- SQLAlchemy ORM
- Pydantic æ•°æ®éªŒè¯
- Pytest æµ‹è¯•æ¡†æ¶

**å·²çŸ¥é—®é¢˜**: æ— 

---

## ğŸ“ ç‰ˆæœ¬è§„èŒƒ

æœ¬é¡¹ç›®éµå¾ª [è¯­ä¹‰åŒ–ç‰ˆæœ¬ 2.0.0](https://semver.org/lang/zh-CN/) è§„èŒƒï¼š

- **ä¸»ç‰ˆæœ¬å·ï¼ˆMajorï¼‰**: ä¸å…¼å®¹çš„ API ä¿®æ”¹
- **æ¬¡ç‰ˆæœ¬å·ï¼ˆMinorï¼‰**: å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢
- **ä¿®è®¢å·ï¼ˆPatchï¼‰**: å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£

### ç‰ˆæœ¬å·ç¤ºä¾‹

- `1.0.0` â†’ `2.0.0`: é‡å¤§é‡æ„ï¼ŒAPI ä¸å…¼å®¹
- `1.0.0` â†’ `1.1.0`: æ–°å¢åŠŸèƒ½ï¼Œå‘ä¸‹å…¼å®¹
- `1.0.0` â†’ `1.0.1`: Bug ä¿®å¤ï¼Œå‘ä¸‹å…¼å®¹

### ç‰ˆæœ¬å‘å¸ƒæµç¨‹

1. æ›´æ–° `app/__version__.py` ä¸­çš„ç‰ˆæœ¬å·å’Œå†å²
2. æ›´æ–° `docs/æ›´æ–°æ—¥å¿—.md` è®°å½•è¯¦ç»†å˜æ›´
3. è¿è¡Œ `python scripts/python/check_version.py` éªŒè¯
4. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ç¡®ä¿é€šè¿‡
5. æäº¤ä»£ç å¹¶åˆ›å»º Git æ ‡ç­¾
6. æ¨é€åˆ°è¿œç¨‹ä»“åº“

---

**æ–‡æ¡£ä¿¡æ¯**

| é¡¹ç›® | å†…å®¹ |
|------|------|
| åˆ›å»ºæ—¥æœŸ | 2025-02-20 |
| ç»´æŠ¤è€… | CorrectPath, A-Dawn, cuckoo711 |
| çŠ¶æ€ | ğŸ“ æ›´æ–°æ—¥å¿— |

